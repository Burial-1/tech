<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小白妹妹写代码</title>
  <icon>https://www.gravatar.com/avatar/33db386efb13607178f855fd69e73158</icon>
  <subtitle>一个废话很多的程序媛</subtitle>
  <link href="/tech/atom.xml" rel="self"/>
  
  <link href="http://sabrinaluo.com/tech/"/>
  <updated>2017-12-05T09:36:02.572Z</updated>
  <id>http://sabrinaluo.com/tech/</id>
  
  <author>
    <name>HiiTea</name>
    <email>luohaojing[at]gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>angular指令什么情况下只能有一个根元素(root element)</title>
    <link href="http://sabrinaluo.com/tech/2017/12/05/angular-directive-only-one-root-element/"/>
    <id>http://sabrinaluo.com/tech/2017/12/05/angular-directive-only-one-root-element/</id>
    <published>2017-12-05T07:28:03.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>好久么有记录什么有用的知识了，总是猴子掰玉米似的学点忘点:(</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在写自定义指令(custom directive)的时候，经常遇到下面这个错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: [$compile:tplrt] Template for directive &apos;xxx&apos; must have exactly one root element.</span><br></pre></td></tr></table></figure></p><p>但有时候又发现别人写的指令超过一个根元素，却并没有报错，真是非常的confusing🤔</p><h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>官访文档在directive一节是找不到任何和replace有关的东西，后来是在$compile一节找到的，然而又已经弃用了……(又要感叹了，前端圈真特喵难混)</p><p>以下为文档说明</p><blockquote><p>replace (DEPRECATED)  </p><ul><li>replace will be removed in next major release - i.e. v2.0).  </li><li>Specifies what the template should replace. Defaults to false.  <ul><li>true - the template will replace the directive’s element.  </li><li>false - the template will replace the contents of the directive’s element.  </li></ul></li><li>The replacement process migrates all of the attributes / classes from the old element to the new one. See the Directives Guide for an example.</li></ul></blockquote><p>大概是说这个replace属性没什么卵用…实际使用的时候也觉得没什么场景是非要replace不可的，不过为了避免在jq selector里使用一堆莫名其妙的dom名称，replace一下让Html看起来更正常一点（对，我们就是jQuery和angular混用，就是这么任！性！🤷‍）</p><h3 id="感悟"><a href="#感悟" class="headerlink" title="感悟"></a>感悟</h3><p>在写组件template的时候用根元素把其他元素wrap起来，其实一个很好的习惯，这样一来，根元素上可以有css class，在使用sass之类的css预处理器时，有根类会使得维护成本变低</p><p>那么为什么会存在有多余一个根元素的组件呢？</p><p>我个人的感觉是，组件在最初设计时，并没有考虑到之后的扩展性，比如要写一个dropdown组件，首先想到的肯定是把select元素作为根元素，于是模板成了这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select class=&quot;xxxx&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></p><p>之后来了个需求：当所选的选项是某一些特定选项时，显示一个error message。这一下就比较尴尬了……</p><p>error message这个<code>div</code>只能和<code>select</code>同一个level才行，因为加在<code>select</code>里是肯定不会显示的。而一旦新加一个wrapper把之前的模板包起来，之前的css可能都要重写才会看起来没有变化。此时影响最小的做法就是移除指令中的<code>replace:true</code>属性，然后加多一个根元素了😂</p><p>Angular本身compile的机制是，如果没有replace:true，默认就是false，<strong>会自动创建一个<code>&lt;directive-name&gt;</code>元素作为根元素</strong>包裹住模板中的全部内容。</p><p>以上。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;好久么有记录什么有用的知识了，总是猴子掰玉米似的学点忘点:(&lt;/p&gt;
&lt;h3 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h3&gt;&lt;p&gt;在写自定义指令(custom directive)的时候，经常遇
      
    
    </summary>
    
      <category term="AngularJS" scheme="http://sabrinaluo.com/tech/categories/AngularJS/"/>
    
    
      <category term="angular" scheme="http://sabrinaluo.com/tech/tags/angular/"/>
    
      <category term="directive" scheme="http://sabrinaluo.com/tech/tags/directive/"/>
    
  </entry>
  
  <entry>
    <title>Angular directive指令相关的scope问题(= @ &amp; ?)</title>
    <link href="http://sabrinaluo.com/tech/2017/09/01/angular-directive-scope/"/>
    <id>http://sabrinaluo.com/tech/2017/09/01/angular-directive-scope/</id>
    <published>2017-09-01T07:59:44.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<h3 id="老生常谈之-isolated-scope"><a href="#老生常谈之-isolated-scope" class="headerlink" title="老生常谈之 isolated scope"></a>老生常谈之 isolated scope</h3><p>每次说到directive, isolated scope总是要被提起的…官方的例子已经很好的说明了为什么我们需要isolated scope。当没有isolated scope的时候，directive依赖于controller的scope，这样每次使用directive，都需要创建新的controller。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"NaomiController"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-customer</span>&gt;</span><span class="tag">&lt;/<span class="name">my-customer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"IgorController"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-customer</span>&gt;</span><span class="tag">&lt;/<span class="name">my-customer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'docsScopeProblemExample'</span>, [])</span><br><span class="line">.controller(<span class="string">'NaomiController'</span>, [<span class="string">'$scope'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">  $scope.customer = &#123;</span><br><span class="line">    name: <span class="string">'Naomi'</span>,</span><br><span class="line">    address: <span class="string">'1600 Amphitheatre'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;])</span><br><span class="line">.controller(<span class="string">'IgorController'</span>, [<span class="string">'$scope'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">  $scope.customer = &#123;</span><br><span class="line">    name: <span class="string">'Igor'</span>,</span><br><span class="line">    address: <span class="string">'123 Somewhere'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;])</span><br><span class="line">.directive(<span class="string">'myCustomer'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    restrict: <span class="string">'E'</span>,</span><br><span class="line">    template: <span class="string">'&lt;div&gt;Name: &#123;&#123;customer.name&#125;&#125; Address: &#123;&#123;customer.address&#125;&#125;&lt;/div&gt;'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Isolated scope 其实就是当你在directive里要return的那个object里，定义一个scope属性，这个<code>scope</code>会override controller中的<code>$scope</code>，从而实现isolated。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'docsIsolateScopeDirective'</span>, [])</span><br><span class="line">.controller(<span class="string">'Controller'</span>, [<span class="string">'$scope'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">  $scope.naomi = &#123; <span class="attr">name</span>: <span class="string">'Naomi'</span>, <span class="attr">address</span>: <span class="string">'1600 Amphitheatre'</span> &#125;;</span><br><span class="line">  $scope.igor = &#123; <span class="attr">name</span>: <span class="string">'Igor'</span>, <span class="attr">address</span>: <span class="string">'123 Somewhere'</span> &#125;;</span><br><span class="line">&#125;])</span><br><span class="line">.directive(<span class="string">'myCustomer'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    restrict: <span class="string">'E'</span>,</span><br><span class="line">    scope: &#123;</span><br><span class="line">      customerInfo: <span class="string">'='</span></span><br><span class="line">    &#125;,</span><br><span class="line">    templateUrl: <span class="string">'my-customer-iso.html'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h3 id="amp"><a href="#amp" class="headerlink" title="= &amp; @ ?"></a><code>=</code> <code>&amp;</code> <code>@</code> <code>?</code></h3><p>通常在写Angular的时候经常看到别人的指令scope里会有下面着这样<code>=</code> <code>@</code> <code>&amp;</code>的符号，我自己呢，90%的时候都是用<code>=</code>，也不知道其他符号到底是干什么用的。今天无心工作，仔细研究了一下。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.directive(<span class="string">'myDirective'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        scope: &#123;</span><br><span class="line">            optionOne: <span class="string">'='</span>,</span><br><span class="line">            optionTwo: <span class="string">'=?'</span>,</span><br><span class="line">            optionThree: <span class="string">'@'</span>,</span><br><span class="line">            optionFour: <span class="string">'&amp;'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h4 id="双向绑定-two-way-binding"><a href="#双向绑定-two-way-binding" class="headerlink" title="= 双向绑定(two way binding)"></a><code>=</code> 双向绑定(two way binding)</h4><p>这个好理解，父子两个scope，任何一个改变，剩下的一个也跟着一起改变</p><p>需要注意的是，传入参数时，是没有花括号的<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">options</span>=<span class="string">"options"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="单向绑定-one-way-binding"><a href="#单向绑定-one-way-binding" class="headerlink" title="@ 单向绑定(one way binding)"></a><code>@</code> 单向绑定(one way binding)</h4><p>首先，单向绑定传入的是一个<strong>字！符！串！</strong>；其次，父scope改变子scope跟着变，但子scope改变时，父scope不会改变！</p><p>由于传入的是一个字符串，所以是需要花括号的，如下，假如父scope中<code>name=&#39;Lucy&#39;</code>，第一个指令接收到的是<code>&#39;name&#39;</code>这个字符串，第二个指令接受的才是<code>&#39;Lucy&#39;</code>这个字符串<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">name</span>=<span class="string">"&#123;&#123;name&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h4 id="amp-绑定函数"><a href="#amp-绑定函数" class="headerlink" title="&amp; 绑定函数"></a><code>&amp;</code> 绑定函数</h4><blockquote><p>The <code>&amp;</code> binding allows a directive to trigger evaluation of an expression in the context of the original scope</p></blockquote><p><code>&amp;</code>绑定允许指令触发原始scope(指令所在的父元素的scope)中的函数</p><blockquote><p>Best Practice: use <code>&amp;attr</code> in the <code>scope</code> option when you want your directive to expose an API for binding to behaviors.</p></blockquote><p>可以理解为传入一个<strong>回调函数</strong>给指令，指令触发该函数，但该函数并不定义在指令的scope中。因为如果该函数定义在directive的scope中，则逻辑是固定的，从外部传入的话，可以传入任意逻辑的函数。</p><p>我的一些<strong>Anti-pattern</strong></p><ul><li>关于函数绑定这个事，我通常直接用<code>=</code>绑定函数，也能用……但这个肯定有什么潜在的问题我没发现；  </li><li>我的另一种用法是，仍然用<code>=</code>绑定一个对象，把函数放在对象里，比如绑定的是<code>options</code>这个对象，但对象中有<code>options.sayHi</code>这个属性（其实是个函数）。</li></ul><p>我能想到的潜在的问题就是，会存在<code>undefined is not a function</code>，但如果检查一下属性是否存在是否类型function不就可以了？？？我知道可能会有问题，但到底会有什么问题呢？🤔</p><p>—- 更新 —-<br>大概知道原因了…不用<code>@</code>很好理解，用<code>@</code>传入的是个字符串不是函数；而不用<code>=</code>因为双向绑定存在子scope改变父scope中的函数的风险，并且也会有<code>$watch</code>的开销，一定程度上影响性能。<br><a href="https://stackoverflow.com/questions/29857998/proper-way-to-pass-functions-to-directive-for-execution-in-link" target="_blank" rel="noopener">https://stackoverflow.com/questions/29857998/proper-way-to-pass-functions-to-directive-for-execution-in-link</a></p><p><code>&amp;</code>绑定后，返回的是一个返回父scope中对应函数的函数😂，有点拗口。举个栗子：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-directive</span> <span class="attr">callback</span>=<span class="string">"sayHi(a,b,c)"</span>&gt;</span><span class="tag">&lt;/<span class="name">my-directive</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>指令中的<code>scope.callback</code>值为<code>function(locals){ return parentGet(scope, locals);}</code></p><p>所以<code>scope.callback({a:1,b:2,c:3})</code>等价于<code>parentScope.sayHi(1,2,3)</code><br>需要注意的是:</p><ul><li><code>scope.callback({a:1,b:2,c:3})</code>的入参是一个<code>object</code></li><li>如果是这样<code>scope.callback({a:1,b:2})</code>，则<code>c</code>的值会与<code>parentScope.c</code>相同。也就是说，如果<strong>子scope</strong>传入的<code>obj</code>中没有定义对应参数，各参数的默认值与<code>parentScope</code>中的对应值一致。如果<strong>父子scope</strong>中都没有定义相关参数，则为<code>undefined</code></li></ul><h4 id=""><a href="#" class="headerlink" title="?"></a><code>?</code></h4><p>问号这个挺简单的，跟glob啊，正则的里面的<code>?</code>意思相似，就是说该属性是否是必需选项，当有问号的时候，说明对应的属性可以省略，而不会报错<code>NON_ASSIGNABLE_MODEL_EXPRESSION</code></p><h3 id="无关感言"><a href="#无关感言" class="headerlink" title="无关感言"></a>无关感言</h3><p>我第一次知道AngularJS大约是3年前，除了学校的一些酱油小项目外完全没有任何开发经验，对于JS只知道jQuery却又要去找一份程序员的工作。面试的时候人家问我：会Angular吗？我：？？？当然是没有面上，回去之后到code school学完了入门课程，在官网学完了那个卖手机的demo。当然之后我也没有直接去做一份跟Angular有关的工作。</p><p>如今，在我终于做着一份Angular1.x的工作时，Angular5都快发布了，（再次感叹，前端圈真难混），而我连TypeScript也还没学会，关于Angular的很多基本问题也还是云里雾里……但这并不妨碍我能写出能在生产环境使用的应用🙄，基础和工程经验这是没什么必然关系，（当然也可能是我天赋异禀而不自知🤣）。其实我现在是很不想写Angular1.x的，总觉得是非常outdated的东西，然而🤷‍</p><p>另外，这篇真是50%以上都是抄袭官网…但是不抄根本记不住…</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>[1] <a href="https://docs.angularjs.org/guide/directive" target="_blank" rel="noopener">https://docs.angularjs.org/guide/directive</a><br>[2] <a href="https://blog.coding.net/blog/angularjs-directive-isolate-scope" target="_blank" rel="noopener">https://blog.coding.net/blog/angularjs-directive-isolate-scope</a><br>[3] <a href="https://stackoverflow.com/questions/14908133/what-is-the-difference-between-vs-and-in-angularjs" target="_blank" rel="noopener">https://stackoverflow.com/questions/14908133/what-is-the-difference-between-vs-and-in-angularjs</a><br>[4] <a href="https://stackoverflow.com/questions/20447786/whats-the-meaning-of-in-angularjs-directive-isolate-scope-declaration" target="_blank" rel="noopener">https://stackoverflow.com/questions/20447786/whats-the-meaning-of-in-angularjs-directive-isolate-scope-declaration</a><br>[5] <a href="https://stackoverflow.com/questions/29857998/proper-way-to-pass-functions-to-directive-for-execution-in-link" target="_blank" rel="noopener">https://stackoverflow.com/questions/29857998/proper-way-to-pass-functions-to-directive-for-execution-in-link</a>  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;老生常谈之-isolated-scope&quot;&gt;&lt;a href=&quot;#老生常谈之-isolated-scope&quot; class=&quot;headerlink&quot; title=&quot;老生常谈之 isolated scope&quot;&gt;&lt;/a&gt;老生常谈之 isolated scope&lt;/h3&gt;&lt;
      
    
    </summary>
    
      <category term="AngularJS" scheme="http://sabrinaluo.com/tech/categories/AngularJS/"/>
    
    
      <category term="angular" scheme="http://sabrinaluo.com/tech/tags/angular/"/>
    
      <category term="directive" scheme="http://sabrinaluo.com/tech/tags/directive/"/>
    
      <category term="scope" scheme="http://sabrinaluo.com/tech/tags/scope/"/>
    
      <category term="isolated scope" scheme="http://sabrinaluo.com/tech/tags/isolated-scope/"/>
    
  </entry>
  
  <entry>
    <title>用webpack打包react组件</title>
    <link href="http://sabrinaluo.com/tech/2017/08/14/react-component-with-webpack/"/>
    <id>http://sabrinaluo.com/tech/2017/08/14/react-component-with-webpack/</id>
    <published>2017-08-14T02:36:56.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<h3 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h3><p>好多人都吐槽Webpack配置太复杂了，然而1.x我都还没学会现在都已经3.x了，前段圈真的好难混啊，真是必须活到老学到老啊…</p><p>前段时间闲得无聊看到个播放器叫<a href="https://github.com/DIYgod/APlayer" target="_blank" rel="noopener">APlayer</a>，就想着包起来做个Vue或者React能用的吧，练练手……然后由于我的拖延症，写了好久，就在我写完Vue版本的第二天，还没push，就发现MD已经有别人比我早几天写好了，好气哦…于是只能重头开始写React版</p><p>因为从开始就是用<code>create-react-app</code>的脚手架，所以也没考虑npm require时候会有什么问题，<a href="http://sabrinaluo.com/react-aplayer/">Demo</a>更是直接写在<code>src</code> 文件夹里，我自己引用的时候当然没有问题啦…不过<code>create-react-app</code>没有提供相应的功能也有别人吐槽过了<a href="https://github.com/facebookincubator/create-react-app/issues/1492" target="_blank" rel="noopener">^1</a></p><p>发布了之后有人给提了个Issue，说引用之后编译的时候有问题，我一看果然…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncaught ReferenceError: React is not defined</span><br></pre></td></tr></table></figure></p><h3 id="正经事儿"><a href="#正经事儿" class="headerlink" title="正经事儿"></a>正经事儿</h3><p><code>/src</code>里的文件都是<code>ES6</code>和<code>JSX</code>形式，第一反应是我的文件没有被webpack里的<code>babel-loader</code>成功编译，查了一些资料之后发现问题是在<code>create-react-app</code>的webpack配置中，只会编译<code>./src</code>下的文件，而当我的库作为第三方依赖引入时，是在<code>./node_modules</code>下，因此没有被编译。（使用webpack编译时通常都会忽略<code>./node_modules</code>下的文件，没理由去编译别人的包呀，也就是说别人发布这个包的时候，就应该是编译好的了，然而偷懒的我没有编译就直接发布了）(⊙﹏⊙)b</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./react-scripts/config/webpack.config.prod.js</span></span><br><span class="line"><span class="comment">// Process JS with Babel.</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">  include: paths.appSrc,</span><br><span class="line">  loader: <span class="built_in">require</span>.resolve(<span class="string">'babel-loader'</span>),</span><br><span class="line">  options: &#123;</span><br><span class="line">    <span class="comment">// @remove-on-eject-begin</span></span><br><span class="line">    babelrc: <span class="literal">false</span>,</span><br><span class="line">    presets: [<span class="built_in">require</span>.resolve(<span class="string">'babel-preset-react-app'</span>)],</span><br><span class="line">    <span class="comment">// @remove-on-eject-end</span></span><br><span class="line">    compact: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>为了编译我的文件，我还要专门写一个<code>webpack.config.js</code>真是好心累…写的时候遇到的问题更心累</p><p>首先就是最基本的配置，相关的<code>loader</code>和minify plugin，编译之后文件很大…原来是把<code>react</code>也打包进去了，如果所有人都这么写组件的话……最后的APP里有几个组件就会有几份重复的react，肯定是不对的。</p><p>之后搜到，要排除某个库，可以用<code>external</code>选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">externals: [&apos;react&apos;]</span><br></pre></td></tr></table></figure></p><p>然而，加上这个时候我的噩梦就来啦，永远都提示<code>React is undefined</code>，试了各种各样的<code>external</code>写法，对象、数组…都不管用。花了两三天时间，才搜到一个说<code>libiaryTarget: &#39;umd&#39;</code>的<a href="https://github.com/zhengweikeng/blog/issues/10" target="_blank" rel="noopener">^2</a></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>1: <a href="https://github.com/facebookincubator/create-react-app/issues/1492" target="_blank" rel="noopener">https://github.com/facebookincubator/create-react-app/issues/1492</a><br>2: <a href="https://github.com/zhengweikeng/blog/issues/10" target="_blank" rel="noopener">https://github.com/zhengweikeng/blog/issues/10</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;吐槽&quot;&gt;&lt;a href=&quot;#吐槽&quot; class=&quot;headerlink&quot; title=&quot;吐槽&quot;&gt;&lt;/a&gt;吐槽&lt;/h3&gt;&lt;p&gt;好多人都吐槽Webpack配置太复杂了，然而1.x我都还没学会现在都已经3.x了，前段圈真的好难混啊，真是必须活到老学到老啊…&lt;/p&gt;
&lt;p
      
    
    </summary>
    
      <category term="WEBPACK" scheme="http://sabrinaluo.com/tech/categories/WEBPACK/"/>
    
    
      <category term="webpack" scheme="http://sabrinaluo.com/tech/tags/webpack/"/>
    
      <category term="react" scheme="http://sabrinaluo.com/tech/tags/react/"/>
    
      <category term="react-component" scheme="http://sabrinaluo.com/tech/tags/react-component/"/>
    
  </entry>
  
  <entry>
    <title>尾逗号(Trailing Comma)的意义</title>
    <link href="http://sabrinaluo.com/tech/2017/07/12/trailing-comma/"/>
    <id>http://sabrinaluo.com/tech/2017/07/12/trailing-comma/</id>
    <published>2017-07-12T03:01:13.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>以前在网上看别人写的代码，有时候会看到这样，数组的最后一个元素后面多一个逗号：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var foo = [</span><br><span class="line">    1,</span><br><span class="line">    2,</span><br><span class="line">    3,</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p><p>作为一个懒癌晚期患者，觉得要多加一个逗号，真是好麻烦！那是naive的我，当然还不知道有版本控制diff这种高级工具，还停留在复制粘贴文件夹的人工版本控制低级阶段…</p><p>后来看到几家大厂的代码规范<a href="https://github.com/airbnb/javascript#functions--signature-invocation-indentation" target="_blank" rel="noopener">^1</a>, <a href="https://google.github.io/styleguide/jsguide.html#features-arrays-trailing-comma" target="_blank" rel="noopener">^2</a>中都有相应的规范。Airbnb的JS代码规范是非常火的，然而最开始的时候我个人比较喜欢的是Google的JS代码规范，就因为A家有我不喜欢的trailing comma。没想到，过了一段时间之后，G家也采用了这一条…而恰好也是这段时间，我一直在思考为什么有的人要把代码写的那么不clean？多年的经验告诉我，所有规则一定都是有原因的！</p><p>传图好麻烦…我就文字描述一下吧。凡是用过git的人应该都知道有diff view这种东西，用来比较两个版本的代码有什么区别。没有尾逗号的时候，当你需要添加一个元素，就需要在最后一个元素的<strong>1. 末尾加上一个逗号，2.换行添加新内容</strong>，如下面的例子所示。</p><p>Before<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var foo = [</span><br><span class="line">    1,</span><br><span class="line">    2</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p><p>After<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var foo = [</span><br><span class="line">    1,</span><br><span class="line">    2,</span><br><span class="line">    3</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p><p>这样一来，diff view中就会显示修改了<strong>两行</strong>代码。如果使用尾逗号，则添加一个元素只需要<strong>1.换行添加新内容</strong>即可，diff view中显示只修改（添加）了一行代码。</p><h3 id="一点人生感悟"><a href="#一点人生感悟" class="headerlink" title="一点人生感悟"></a>一点人生感悟</h3><p>这个世界上，凡事都是trade off，算法复杂度里要么时间换空间要么空间换时间。<br>尾逗号也一样，想要diff view clean，代码就不那么clean；想要代码clean，diff view就不那么clean。<br>所以搞清楚自己想要什么，又有什么可以去trade off，就很重要了。</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>[1] <a href="https://medium.com/@nikgraf/why-you-should-enforce-dangling-commas-for-multiline-statements-d034c98e36f8" target="_blank" rel="noopener">https://medium.com/@nikgraf/why-you-should-enforce-dangling-commas-for-multiline-statements-d034c98e36f8</a><br>[2] <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Trailing_commas" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Trailing_commas</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;以前在网上看别人写的代码，有时候会看到这样，数组的最后一个元素后面多一个逗号：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
      
    
    </summary>
    
      <category term="CODE STYLE" scheme="http://sabrinaluo.com/tech/categories/CODE-STYLE/"/>
    
    
      <category term="版本控制" scheme="http://sabrinaluo.com/tech/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
      <category term="trailing comma" scheme="http://sabrinaluo.com/tech/tags/trailing-comma/"/>
    
      <category term="comma-dangle" scheme="http://sabrinaluo.com/tech/tags/comma-dangle/"/>
    
      <category term="尾逗号" scheme="http://sabrinaluo.com/tech/tags/%E5%B0%BE%E9%80%97%E5%8F%B7/"/>
    
  </entry>
  
  <entry>
    <title>关于本地化的一些技巧</title>
    <link href="http://sabrinaluo.com/tech/2017/05/26/interpolation-and-pluralization/"/>
    <id>http://sabrinaluo.com/tech/2017/05/26/interpolation-and-pluralization/</id>
    <published>2017-05-26T09:59:03.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>在香港工作总是能接触到各种“本地化”的需求，大多数网站至少都会有中英文两个版本，有的还会分简体中文和繁体中文。而在实现本地化的过程中，由于英文与中文的文法、语序等差异，会有很多情况需要处理。</p><h3 id="i18n-amp-i10n"><a href="#i18n-amp-i10n" class="headerlink" title="i18n &amp; i10n"></a>i18n &amp; i10n</h3><p>一直以来我都混淆使用这两个term，其中i18n是国际化，主要用于世界通用内容的翻译，<strong>使产品无需做大的改变就能够适应不同的语言和地区的需要</strong>，包括时间、日期、货币等；而i10n是本地化，也就是把网站里其他内容进行翻译。</p><h3 id="content-key"><a href="#content-key" class="headerlink" title="content key"></a>content key</h3><p>将需要翻译的位置用<strong>Content Key</strong>占位，在单独的文件里来处理对应的翻译已经成为了本地化的最基本策略。这样做的好处是，1. 保持代码的整洁，无需因为翻译问题不断提交commit，避免污染git history；2. 方便不懂代码的运营人员随时调整翻译内容，而无需增加开发负担。</p><h3 id="单复数-pluralization"><a href="#单复数-pluralization" class="headerlink" title="单复数 pluralization"></a>单复数 pluralization</h3><p>举个栗子，如果需要翻译“x个苹果”，对应的英文会有单复数形式，遇到这种情况的时候，如果缺乏经验，通常是写<code>if</code> <code>else</code>， 然后用两个不同的key：</p><table><thead><tr><th>key</th><th>zh</th><th>en</th></tr></thead><tbody><tr><td>webstie.key.apple</td><td>个苹果</td><td>apple</td></tr><tr><td>webstie.key.apples</td><td>个苹果</td><td>apples</td></tr></tbody></table><p>但是template里写太多的if else 容易使得逻辑混乱，也不利于维护，机智的我今天忽然发现angular其实有一个专门的指令来做这个事:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ng-pluralize count=&quot;personCount&quot;</span><br><span class="line">                 when=&quot;&#123;&apos;0&apos;: &apos;Nobody is viewing.&apos;,</span><br><span class="line">                     &apos;one&apos;: &apos;1 person is viewing.&apos;,</span><br><span class="line">                     &apos;other&apos;: &apos;&#123;&#125; people are viewing.&apos;&#125;&quot;&gt;</span><br><span class="line">&lt;/ng-pluralize&gt;</span><br></pre></td></tr></table></figure><p>这个指令的本质其实跟if else类似，使用了一个hash map来储存对应的翻译，而我们可以利用这个指令，把when的值写到controller里，这样会比较美观 XD</p><h3 id="插值-interpolation"><a href="#插值-interpolation" class="headerlink" title="插值 interpolation"></a>插值 interpolation</h3><p>有时候我们不得不把一整句话打断成多个部分，比如“step 1 of 5 ”，而对应的中文如果要求翻译成“第1步（共5步）”。这种情况下，如果使用断句的方法来翻译，中文需要有3个key，分别对应</p><table><thead><tr><th>lang</th><th>part1</th><th>part2</th><th>part3</th></tr></thead><tbody><tr><td>en</td><td>step</td><td>of</td><td></td></tr><tr><td>zh</td><td>第</td><td>步（共</td><td>步）</td></tr></tbody></table><p>这样做，不仅不美观，写起来<code>string + string + string</code>也非常麻烦，同时代码及翻译文件都增加了维护的难度。</p><p>大家应该都有经验，在<code>console.log</code>中，可以使用<code>%s</code>作为占位符，如果能够使用占位符来进行翻译，以上情况就会简单很多。</p><p>Angular原生的<code>$interpolate</code>服务，用于编译含有特定标记的字符串，<code>Hello, {{name}}</code></p><blockquote><p>Compiles a string with markup into an interpolation function</p></blockquote><p>翻译时，大多时候时候都是用<code>angular-translate</code>，这个第三方的服务能很好的处理插值，使用的标记是两个花括号<code>{{}}</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//基本用法</span><br><span class="line">$translate(translationId[, interpolateParams], interpolationId, defaultTranslationText, forceLanguage);</span><br><span class="line"></span><br><span class="line">//例子</span><br><span class="line">$scope.stepInfoText = $filter(&apos;translate&apos;)(&apos;widget-progress-bar.step.text&apos;, &#123;currentStep:1, totalStep: 5&#125;);</span><br><span class="line"></span><br><span class="line">//翻译文件 *.properties</span><br><span class="line">widget-progress-bar.step.text=step &#123;&#123;currentStep&#125;&#125; of &#123;&#123;totalStep&#125;&#125;</span><br><span class="line">//output: step 1 of 5</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>1: <a href="https://docs.angularjs.org/guide/i18n" target="_blank" rel="noopener">https://docs.angularjs.org/guide/i18n</a><br>2: <a href="https://docs.angularjs.org/api/ng/directive/ngPluralize" target="_blank" rel="noopener">https://docs.angularjs.org/api/ng/directive/ngPluralize</a><br>3: <a href="https://stackoverflow.com/questions/27259723/angularjs-pluralization-with-angular-translate-and-ng-pluralize" target="_blank" rel="noopener">https://stackoverflow.com/questions/27259723/angularjs-pluralization-with-angular-translate-and-ng-pluralize</a><br>4: <a href="https://docs.angularjs.org/api/ng/service/$interpolate" target="_blank" rel="noopener">https://docs.angularjs.org/api/ng/service/$interpolate</a><br>5: <a href="https://angular-translate.github.io/docs/#/api/pascalprecht.translate.$translate" target="_blank" rel="noopener">https://angular-translate.github.io/docs/#/api/pascalprecht.translate.$translate</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在香港工作总是能接触到各种“本地化”的需求，大多数网站至少都会有中英文两个版本，有的还会分简体中文和繁体中文。而在实现本地化的过程中，由于英文与中文的文法、语序等差异，会有很多情况需要处理。&lt;/p&gt;
&lt;h3 id=&quot;i18n-amp-i10n&quot;&gt;&lt;a href=&quot;#i18n
      
    
    </summary>
    
      <category term="AngularJS" scheme="http://sabrinaluo.com/tech/categories/AngularJS/"/>
    
    
      <category term="interpolation" scheme="http://sabrinaluo.com/tech/tags/interpolation/"/>
    
      <category term="pluralization" scheme="http://sabrinaluo.com/tech/tags/pluralization/"/>
    
      <category term="localization" scheme="http://sabrinaluo.com/tech/tags/localization/"/>
    
      <category term="翻译" scheme="http://sabrinaluo.com/tech/tags/%E7%BF%BB%E8%AF%91/"/>
    
      <category term="本地化" scheme="http://sabrinaluo.com/tech/tags/%E6%9C%AC%E5%9C%B0%E5%8C%96/"/>
    
      <category term="单复数" scheme="http://sabrinaluo.com/tech/tags/%E5%8D%95%E5%A4%8D%E6%95%B0/"/>
    
      <category term="ng-pluralize" scheme="http://sabrinaluo.com/tech/tags/ng-pluralize/"/>
    
  </entry>
  
  <entry>
    <title>一点感悟</title>
    <link href="http://sabrinaluo.com/tech/2017/05/11/thoughts/"/>
    <id>http://sabrinaluo.com/tech/2017/05/11/thoughts/</id>
    <published>2017-05-11T03:21:54.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>不知道为什么，我是比较喜欢JS这种脑残语言的，并且也不想将其他语言用在工作中，比如PHP、PYTHON、JAVA之类的。</p><p>其实到最后肯定所有语言都是相通的，比如每种语言都会有自己的<code>lodash</code>、<code>npm</code>、<code>package.json</code>，所以当精通一种语言之后是能对其他语言的人指点江山的。我之前的一个同事新手写python，库也不会用也不知道去哪里下载，我对Python的认识只限于这是一个用缩进来控制块的语言，但搜了一下果然有<code>pip</code>，<code>requirements.txt</code></p><p>举这个例子是因为我认为，用一个语言用得精通比会用很多语言都是略知一二更重要。</p><p>前几天我有一个写PHP的同事，被迫去写nodeJS，然后遇到一个soap的问题，调了一天都没调出来，扔给我帮忙。问题大概是，用了一个叫<code>node-soap</code>的库，发请求的时候对方服务器总是返回<code>ERROR Invalid XML</code>，而用Postman把请求的body发出去，却能得到成功的返回结果，同事怀疑这个第三方库有问题。</p><p>我虽然对SOAP一窍不通，但我懂JS，觉得这个问题应该能找出原因。根据以前的经验，我觉得不太可能是第三方库的问题，因为每次只使用基本方法却有问题时我debug到别人库里去看明白原理之后，绝大多数时候都会发现是自己的问题。更何况这是一个1500+ star的库。</p><p>首先我想到的是，肉眼看上去同样的body，为什么得到不同的结果？很可能是encoding的问题。单步调试后发现库里并没有任何encoding的动作，所以排除该问题。</p><p>后来我注意到，第三方库在发送请求的时候发了很多header，把这些header也写进postman之后，果然返回了同样的错误。而之前同事测试时，postman里header都是默认值。所以可以肯定问题出在header上。</p><p>删除了<code>SOAPAction</code>这个header之后，请求就成功了。再具体到库里去搜这个<code>SOAPAction</code>，发现有一段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!this.wsdl.options.forceSoap12Headers) &#123;</span><br><span class="line">  headers.SOAPAction = &apos;&quot;&apos; + soapAction + &apos;&quot;&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>猜测应该是有一个<code>forceSoap12Headers</code>相关的设置，再去文档里一搜，果然有，把这个设置为<code>true</code>之后，问题就解决了。前后大概花了一小时。</p><p>写这篇是想说，磨刀不误砍柴工，首先你得学会怎么磨刀，然后得学会怎么砍柴，这样才能磨刀不误砍柴工。对于一个完全不熟悉的东西，因为掌握了最基本的方法，才能万物归一的去解决。</p><p>我反对对于不熟悉的东西，一上来就通看文档。在工作当中，是没有那么多时间让你从头去看文档，把所有东西都弄明白之后才开始工作的。<br>文档对于没有经验的人来说看quick start部分就够，因为就算看到<code>forceSoap12Headers</code>，也不知道是干什么用的。<br>对于有经验的人，才会需要在一开始就去细看<code>forceSoap12Headers</code>的设置</p><p>我也反对把写一种语言的员工强行安排暂时写另一种语言。除非是打算长期转向另一种语言，否则一两天做完一个task，根本不会对新的语言有系统性的研究，甚至都不知道debug的工具怎么用，对个人的发展是没什么实质性的帮助的，而且写出来的代码大都只能达到“能用”的程度，可维护性和稳定性都不一定会好，长远来看对公司也是不太好的。不过创业公司嘛，半年一次revamp，好像也没什么问题…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;不知道为什么，我是比较喜欢JS这种脑残语言的，并且也不想将其他语言用在工作中，比如PHP、PYTHON、JAVA之类的。&lt;/p&gt;
&lt;p&gt;其实到最后肯定所有语言都是相通的，比如每种语言都会有自己的&lt;code&gt;lodash&lt;/code&gt;、&lt;code&gt;npm&lt;/code&gt;、&lt;co
      
    
    </summary>
    
      <category term="心得体会" scheme="http://sabrinaluo.com/tech/categories/%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A/"/>
    
    
      <category term="forceSoap12Headers" scheme="http://sabrinaluo.com/tech/tags/forceSoap12Headers/"/>
    
      <category term="soap" scheme="http://sabrinaluo.com/tech/tags/soap/"/>
    
  </entry>
  
  <entry>
    <title>openvpn在mac下的一点问题</title>
    <link href="http://sabrinaluo.com/tech/2017/01/03/vpn/"/>
    <id>http://sabrinaluo.com/tech/2017/01/03/vpn/</id>
    <published>2017-01-03T06:42:57.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>今天才发现自从买了新Mac之后根本没有用新电脑写过什么东西，导致我今天居然还要<code>npm install</code>才能跑起来HEXO，真是不知道有多懒。</p><p>作为一个在墙外居住了好几年的人，只知道用Unblock youku翻墙进墙内去看视频，根本不知道在墙内怎么翻出来。早些年的时候，翻到墙外是很简单的，免费的软件也很多，好像也不用VPN啥，host文件里加几个IP啥的就能上Google了，现在真是门槛越来越高了呢……回一趟内地80%我平时上的网站都上不去，公司的网站也上不去，反正根本没法work from home，幸好我是在过年前发现了这个问题，现在还来得及解决一下，不然就呵呵呵呵……</p><p>以前好像也用过<code>.ovpn</code>文件，用命令行跑一下，就连上了vpn，现在已经不记得是怎么用了的…今天忽然发现公司居然有openvpn，妈妈再也不用担心我在内地没法工作了，对的，我的心里只有工作！:P</p><p>通常公司提供的openvpn服务都会有一个portal，也就是有个网址，进入之后需要登录公司提供的账号，然后下载相应的客户端，之后基本上是无脑使用……反正我到现在也不知道我电脑上的credentials是怎么生成的。</p><p>然而高贵的mac总是有各种各样的问题，装好openvpn connect之后居然连接错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fails: Error running jsondialog</span><br></pre></td></tr></table></figure></p><p>查了一下这是因为mac下的一个什么<code>csrutil</code>保护机制出于enable状态，<code>csrutil status</code>可查看。而disable这个东西需要在recovery mode下跑命令才行……真是麻烦呢。</p><ul><li>重启电脑，按住cmd+r键进入recovery mode</li><li>开头会让选个语言，选完之后会出来一个对话框，里面有好多选项，一个都不要选！</li><li>在顶部的工具条中点击utilities，然后选terminal</li><li>在命令行工具中执行<code>csrutil disable; reboot</code></li><li>重启之后就能连接上了</li></ul><p>参考：<br>[1]<a href="https://forums.openvpn.net/viewtopic.php?t=19879" target="_blank" rel="noopener">https://forums.openvpn.net/viewtopic.php?t=19879</a><br>[2]<a href="http://osxdaily.com/2015/10/05/disable-rootless-system-integrity-protection-mac-os-x/" target="_blank" rel="noopener">http://osxdaily.com/2015/10/05/disable-rootless-system-integrity-protection-mac-os-x/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今天才发现自从买了新Mac之后根本没有用新电脑写过什么东西，导致我今天居然还要&lt;code&gt;npm install&lt;/code&gt;才能跑起来HEXO，真是不知道有多懒。&lt;/p&gt;
&lt;p&gt;作为一个在墙外居住了好几年的人，只知道用Unblock youku翻墙进墙内去看视频，根本不知
      
    
    </summary>
    
    
      <category term="VPN" scheme="http://sabrinaluo.com/tech/tags/VPN/"/>
    
      <category term="openvpn" scheme="http://sabrinaluo.com/tech/tags/openvpn/"/>
    
      <category term="翻墙" scheme="http://sabrinaluo.com/tech/tags/%E7%BF%BB%E5%A2%99/"/>
    
  </entry>
  
  <entry>
    <title>一些js小技巧</title>
    <link href="http://sabrinaluo.com/tech/2016/10/19/some-js-tricks/"/>
    <id>http://sabrinaluo.com/tech/2016/10/19/some-js-tricks/</id>
    <published>2016-10-19T07:08:33.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>一直以为这篇已经发过了，结果前两天搜的时候发现搜不到。一直扔在草稿里，今天整理一下之前和最近学到的一些JS小技巧</p><h3 id="利用位运算取整"><a href="#利用位运算取整" class="headerlink" title="利用位运算取整"></a>利用位运算取整</h3><p>利用位运算，与、或、异或、左右移位，<code>&amp;</code> <code>|</code> <code>^</code> <code>&gt;&gt;</code> <code>&gt;&gt;&gt;</code> <code>&lt;&lt;</code> ，舍去小数点后的数字<a href="http://www.cnblogs.com/kkun/archive/2012/01/30/2332309.html" target="_blank" rel="noopener">^1</a>，<a href="http://jsperf.com/coercion-vs-casting/3" target="_blank" rel="noopener">jsPerf</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = 6.54321;</span><br><span class="line">console.log(a | 0); //6</span><br><span class="line">console.log(a &amp; 0); //6</span><br></pre></td></tr></table></figure></p><blockquote><p>按位<strong>非非</strong>运算也是可以的，所以你也可以用<strong>呻吟号</strong>把代码写成这样<code>~~a</code></p></blockquote><h3 id="字符串转换为数字"><a href="#字符串转换为数字" class="headerlink" title="+ 字符串转换为数字"></a>+ 字符串转换为数字</h3><p>利用加号 <code>+</code> 将数字字符串转换为数字类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = &quot;56789&quot;;</span><br><span class="line">var b = +a;</span><br><span class="line">console.log(typeof b); //number</span><br><span class="line">console.log(b); //56789</span><br></pre></td></tr></table></figure></p><blockquote><ul><li>只能是十进制</li><li>如果<code>a</code>是非数字字符串，则会返回<code>NaN</code></li></ul></blockquote><h3 id="强制转换为布林类型"><a href="#强制转换为布林类型" class="headerlink" title="!! 强制转换为布林类型"></a>!! 强制转换为布林类型</h3><p>利用<code>!!</code>将变量类型强制转换为<code>boolean</code>类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a=123;</span><br><span class="line">typeof a; //nmuber</span><br><span class="line">typeof !!a; //boolean</span><br></pre></td></tr></table></figure><h3 id="避免can-not-read-property-‘xxx’-of-null的小技巧"><a href="#避免can-not-read-property-‘xxx’-of-null的小技巧" class="headerlink" title="避免can not read property ‘xxx’ of null的小技巧"></a>避免<code>can not read property ‘xxx’ of null</code>的小技巧</h3><p>经常会遇到的一个情况是下面的代码会报错<code>can not read property &#39;c&#39; of null</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(a.b.c === 1)&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以前自己的写法以及经常见到的写法是这样</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(a &amp;&amp; a.b &amp;&amp; a.b.c === 1)&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前几天看到一个逼格很高的写法，不过我觉得括号太多了，容易写错，而且也没有上面的那种写法简单。不过还是要记录一下，以免以后见到不知道是什么意思。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(((a||&#123;&#125;).b||&#123;&#125;).c === 1)&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="设置默认值"><a href="#设置默认值" class="headerlink" title="|| 设置默认值"></a>|| 设置默认值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function abc(a, b)&#123;</span><br><span class="line">    a = a || 1; </span><br><span class="line">    b = b || 2;</span><br><span class="line"></span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abc(); //3</span><br><span class="line">abc(5); //7</span><br></pre></td></tr></table></figure><p>有一些情况下函数中需要设置默认值，经常看到有人的写法是<code>typeof</code>先判断这个参数是不是<code>undefined</code>然后再赋值，这种写法实在是太麻烦了……上面的是懒人写法</p><p>感觉善用<code>||</code>和<code>&amp;&amp;</code>还是能搞出很多黑科技的。</p><p>以上，是为打酱油博客一篇。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;一直以为这篇已经发过了，结果前两天搜的时候发现搜不到。一直扔在草稿里，今天整理一下之前和最近学到的一些JS小技巧&lt;/p&gt;
&lt;h3 id=&quot;利用位运算取整&quot;&gt;&lt;a href=&quot;#利用位运算取整&quot; class=&quot;headerlink&quot; title=&quot;利用位运算取整&quot;&gt;&lt;/a&gt;利
      
    
    </summary>
    
      <category term="JS" scheme="http://sabrinaluo.com/tech/categories/JS/"/>
    
    
      <category term="js" scheme="http://sabrinaluo.com/tech/tags/js/"/>
    
      <category term="tricks" scheme="http://sabrinaluo.com/tech/tags/tricks/"/>
    
      <category term="js小技巧" scheme="http://sabrinaluo.com/tech/tags/js%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>CSS的几个小技巧：pointer-events, transform垂直居中,nth-child</title>
    <link href="http://sabrinaluo.com/tech/2016/09/20/some-css-tricks/"/>
    <id>http://sabrinaluo.com/tech/2016/09/20/some-css-tricks/</id>
    <published>2016-09-20T08:44:46.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>千万不要用没有自动保存功能的编辑器！千万不要用没有自动保存功能的编辑器！千万不要用没有自动保存功能的编辑器！:(</p></blockquote><p>好久没有写什么东西了，可能是因为最近一直做的事情都是在重复搬砖，没有什么新鲜的东西…更可能是因为太懒了…</p><p>总结一下前段时间学到的几个css小技巧，以免过几天又忘记了</p><h3 id="CSS控制超链接是否可点击：pointer-event"><a href="#CSS控制超链接是否可点击：pointer-event" class="headerlink" title="CSS控制超链接是否可点击：pointer-event"></a>CSS控制超链接是否可点击：pointer-event</h3><p>一开始我听说CSS可以disable超链接的时候我是拒绝的，因为通常在有<code>href</code>属性的时候，都是用js来禁止超链接的。<br>然鹅…CSS里居然有pointer-events<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/pointer-events" target="_blank" rel="noopener">^1</a>这种黑科技！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&#123;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="transform-垂直居中-2"><a href="#transform-垂直居中-2" class="headerlink" title="transform 垂直居中 ^2"></a>transform 垂直居中 <a href="http://zerosixthree.se/vertical-align-anything-with-just-3-lines-of-css/" target="_blank" rel="noopener">^2</a></h3><p>CSS垂直居中一直是一个蛋疼的问题，常常需要用到，却没有一个所有浏览器，在所有情况下都适用的解决方案。等我以后有空了，应该专门写一篇讨论CSS垂直居中各种解决方案的博客……别问我以后是什么时候…XD<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">.bbb&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    transform: translateY(-50%);</span><br><span class="line">    top: 50%</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class=&quot;aaa&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;bbb&quot;&gt;qqq&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><h3 id="nth-child"><a href="#nth-child" class="headerlink" title="nth-child"></a>nth-child</h3><p>通常一个列表里，总是回遇到需要高亮某几个item的情况，CSS居然还可以通过公式来控制样式，我又涨姿势了。</p><p>以前只知道可以控制奇数偶数这种简单的，后来发现，只要是有规律的，能够写成an+b的公式，都可以适用<code>nth-child</code><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-child" target="_blank" rel="noopener">^3</a></p><ul><li><code>li:nth-child(even)</code> 选中偶数</li><li><code>li:nth-child(odd)</code> 选中奇数</li><li><code>li:nth-child(3n+2)</code> 从第2个开始，每3个选中一个</li><li><code>li:nth-child(3)</code> 直选中第3个</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;千万不要用没有自动保存功能的编辑器！千万不要用没有自动保存功能的编辑器！千万不要用没有自动保存功能的编辑器！:(&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;好久没有写什么东西了，可能是因为最近一直做的事情都是在重复搬砖，没有什么新鲜的东西…更可能是
      
    
    </summary>
    
      <category term="CSS" scheme="http://sabrinaluo.com/tech/categories/CSS/"/>
    
    
      <category term="css" scheme="http://sabrinaluo.com/tech/tags/css/"/>
    
      <category term="tricks" scheme="http://sabrinaluo.com/tech/tags/tricks/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins集成github pull request插件</title>
    <link href="http://sabrinaluo.com/tech/2016/07/14/jenkins-github-pull-request-builder/"/>
    <id>http://sabrinaluo.com/tech/2016/07/14/jenkins-github-pull-request-builder/</id>
    <published>2016-07-14T06:41:02.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>前不久给bootstrap提了个<a href="https://github.com/twbs/bootstrap/issues/19997" target="_blank" rel="noopener">issue</a>，然后被他们的高科技自动回复机器人吓萌比了。<br>有印象之前给，某些repo提PR的时候，如果是用的Travis CI，也会有相应的提示该PR是否pass了所有test case。</p><p>如果使用cloud based CI，很多功能都已经整合了，所以可以很方便的使用。如上travis的例子，只要在travis配置里开启pull request选项，允许PR过来的时候自动跑测试，就可以实现。</p><p>然而，如果使用的是jenkins这种自己服务器上的CI，配置就稍微有点麻烦了。</p><h3 id="整合push和jenkins"><a href="#整合push和jenkins" class="headerlink" title="整合push和jenkins"></a>整合push和jenkins</h3><p>github repo页面 &gt; Settings &gt; webhooks &amp; services</p><p>这里有两个选项：</p><ol><li>add webhook，可自定义触发事件，可定制程度较高</li><li>add service，选好对应的服务，只填一个url即可，可定制程度较低。</li></ol><p>第一个比较复杂，但是点进去看看有哪些选项也就比较清晰明了大概用法了。<br>第二个，如果使用jenkins，需要你的jenkins服务器装有对应的插件。</p><p>整个流程的原理是，当github收到任何事件（比如push, pr等等），就会将对应的信息发送到你填的那个url中。这个url是你jenkins服务器用来接受信息的。Jenkins收到信息之后，就会根据job的配置做相应的事情，比如构建、测试、部署等等。</p><h3 id="整合pull-request"><a href="#整合pull-request" class="headerlink" title="整合pull request"></a>整合pull request</h3><p>这里重点说一下怎么整合jenkins和github的pull request，<strong>实现每当有pull request时，触发CI跑测试，并将测试结果显示在github上</strong>。</p><p>这里需要分别在github和jenkins做相应的设置。</p><p>github中的设置与上部分提到的相同，主要是填url</p><p>jenkins服务器中：<br>首先需要安装 <a href="https://wiki.jenkins-ci.org/display/JENKINS/GitHub+pull+request+builder+plugin" target="_blank" rel="noopener">github pull request builder plugin</a></p><p>添加用户名、密码、token等等credentials相关的需要在jenkins的管理面板添加</p><ul><li>source code management，除基本选项外，需要填写advanced选项。<ul><li>repo name: <code>origin</code></li><li>repo refspec: <code>+refs/pull/*:refs/remotes/origin/pr/*</code></li><li>repository browser 选择githubweb</li></ul></li><li>Build Triggers:<ul><li>勾选 Github Pull Request Builder</li><li>勾选 Use github hooks for build triggering</li><li>Admin List里可以填写github用户名，这样该用户就会有对应的权限</li><li>advanced选项中，需要在White List以及List of organizetions填写相应的用户名，这样PR才能被自动build，不在白名单里的用户提交的pr需要管理员审核后才会build</li><li>如果没有勾选 Build every pull request automatically without asking (Dangerous!)，每次有pr时，机器人账号会自动评论<em>“Can one of the admins verify this patch?”</em>，之后管理员回复相应的语句来触发Jenkins操作<ul><li>“ok to test” 允许该pr之后自动触发jenkins build</li><li>“test this please” 只build一次，该pr之后的改动不会自动触发Build</li><li>“add to whitelist” 将该pr的作者假如白名单</li><li>“retest this please” 重新bulid一次<br><strong>其他选项都保持默认不要更改！</strong></li></ul></li></ul></li><li>构建、环境相关的设置例如<code>npm install</code> <code>npm test</code>等，跟平时一样即可。</li></ul><p>最后保存设置，提交一个pr，如果设置都正确的话，在提交pr的页面将能看到一个“正在checking…”的提示，当测试跑完之后将能看到check passed或者check failed。另外也能够在pr overview页面看到pr后面会有个绿色的小勾或红色的小叉。</p><p>于是谁提交的pr不通过测试就能一目了然，再也不用帮别人fix test case啦！</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://jakubstas.com/github-and-jenkins-pull-request-checking" target="_blank" rel="noopener">http://jakubstas.com/github-and-jenkins-pull-request-checking</a><br><a href="http://jakubstas.com/github-and-jenkins-integration" target="_blank" rel="noopener">http://jakubstas.com/github-and-jenkins-integration</a><br><a href="https://www.theguild.nl/building-github-pull-requests-with-jenkins" target="_blank" rel="noopener">https://www.theguild.nl/building-github-pull-requests-with-jenkins</a><br><a href="https://wiki.jenkins-ci.org/display/JENKINS/GitHub+pull+request+builder+plugin" target="_blank" rel="noopener">https://wiki.jenkins-ci.org/display/JENKINS/GitHub+pull+request+builder+plugin</a><br><a href="https://github.com/jenkinsci/ghprb-plugin" target="_blank" rel="noopener">https://github.com/jenkinsci/ghprb-plugin</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;前不久给bootstrap提了个&lt;a href=&quot;https://github.com/twbs/bootstrap/issues/19997&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;issue&lt;/a&gt;，然后被他们的高科技自动回复机器人吓萌比了。&lt;b
      
    
    </summary>
    
      <category term="DEVOPS" scheme="http://sabrinaluo.com/tech/categories/DEVOPS/"/>
    
    
      <category term="github" scheme="http://sabrinaluo.com/tech/tags/github/"/>
    
      <category term="持续集成" scheme="http://sabrinaluo.com/tech/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
      <category term="jenkins" scheme="http://sabrinaluo.com/tech/tags/jenkins/"/>
    
      <category term="CI" scheme="http://sabrinaluo.com/tech/tags/CI/"/>
    
  </entry>
  
  <entry>
    <title>微博开放平台的Basic Auth和OAuth2.0认证</title>
    <link href="http://sabrinaluo.com/tech/2016/06/20/intro-of-oauth2-0/"/>
    <id>http://sabrinaluo.com/tech/2016/06/20/intro-of-oauth2-0/</id>
    <published>2016-06-20T09:59:09.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文章不是讲各种认证方式是怎么实现的，只是简单的介绍如何与微博进行整合。</p><p>微博开放平台允许使用api来开发一些与微博相关的应用，微博提供<strong>Basic Auth</strong>和<strong>OAuth2.0</strong>两种认证方式，其中Basic Auth只能用于测试环境。</p><h3 id="Basic-Auth"><a href="#Basic-Auth" class="headerlink" title="Basic Auth"></a>Basic Auth</h3><p>跟名字一样，就是很基本很简单。其本质是使用<code>username:password</code>进行<code>base64</code>加密之后得到一个token，然后发送的请求中添加一个header <code>Authorization: Basic token</code>。</p><h3 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h3><p>生产环境中，微博只允许使用这种认证方式，这个比起直接用用户名和密码就要复杂一些。</p><p>简单的来说OAuth2.0认证的流程大概是这样：</p><ol><li>首先发一个请求去微博，告诉它，我要登陆啦</li><li>然后微博返回一个登录页面，等待用户用微博账号登陆</li><li>用户登陆之后，页面会跳转到<strong>授权回调页</strong>，这个页面的url会有一个query是<code>code=</code>，后面跟着的一串code</li><li>当进行其他api调用时，在api后加上query<code>code=xxx</code>以及其他要求的参数，比如<code>client_id</code>，<code>client_key</code>等等即可进行调用</li></ol><ul><li>开放平台&gt;我的应用&gt;应用信息&gt;基本信息，这里能看到app key和 app token</li><li>开放平台&gt;我的应用&gt;应用信息&gt;高级信息，这里需要填写授权回调页和取消授权回调页</li></ul><p>需要注意的是，在第2步和第3步中，授权回调页的链接一定要和在申请app时填写的<strong>一！模！一！样！</strong>，否则会报错。</p><p>比如在app填写的是<code>http://example.com/auth/</code>，而api请求时参数写为<code>http://example.com/auth</code>，少了个斜杠都是错的…</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>[1] <a href="http://open.weibo.com/wiki/Oauth2/authorize" target="_blank" rel="noopener">http://open.weibo.com/wiki/Oauth2/authorize</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这篇文章不是讲各种认证方式是怎么实现的，只是简单的介绍如何与微博进行整合。&lt;/p&gt;
&lt;p&gt;微博开放平台允许使用api来开发一些与微博相关的应用，微博提供&lt;strong&gt;Basic Auth&lt;/strong&gt;和&lt;strong&gt;OAuth2.0&lt;/strong&gt;两种认证方式，其
      
    
    </summary>
    
      <category term="AUTH" scheme="http://sabrinaluo.com/tech/categories/AUTH/"/>
    
    
      <category term="OAuth2.0" scheme="http://sabrinaluo.com/tech/tags/OAuth2-0/"/>
    
  </entry>
  
  <entry>
    <title>利用travis进行heroku部署</title>
    <link href="http://sabrinaluo.com/tech/2016/06/02/travis-heroku/"/>
    <id>http://sabrinaluo.com/tech/2016/06/02/travis-heroku/</id>
    <published>2016-06-02T07:27:46.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>好久么有写东西了，总感觉一直忙的跟狗一样，身心俱疲，但是又不知道到底在忙什么。</p><p>最近实践了一下利用travis部署到heroku的流程，又莫名其妙的尝试了新的编辑器atom，安装了markdown-preview-plus插件，当然要来写点东西试一试， 也不知道英文的linux下到底是什么问题，webstorm和sublime居然不能打中文，所以之前每次写东西都要去简书边预览边写。</p><p>atom还是很好用的，可能因为我（后）天生就对JS写的东西有好感，记不住快捷键的我，不能徒手写html的我还是需要IDE的帮助，atom就用来写点简单的东西吧。</p><p>travis和heroku都有自己的命令行工具（CLI），尤其travis cli用起来总比徒手写.travis.yml方便许多</p><h3 id="安装travis-cli"><a href="#安装travis-cli" class="headerlink" title="安装travis-cli"></a>安装travis-cli</h3><p>travis-cli是ruby写的，所以安装之前需要安装ruby</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ruby-full</span><br></pre></td></tr></table></figure><p>详细的安装教程可以看官方的这个<a href="https://github.com/travis-ci/travis.rb#installation" target="_blank" rel="noopener">https://github.com/travis-ci/travis.rb#installation</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install travis -v 1.8.2 --no-rdoc --no-ri</span><br></pre></td></tr></table></figure><h3 id="安装heroku-cli"><a href="#安装heroku-cli" class="headerlink" title="安装heroku-cli"></a>安装heroku-cli</h3><p>heroku-cli也是ruby写的……有点不懂为啥都喜欢用ruby写cli？js不是挺好的吗，有啥cli是<code>npm install -g</code> 解决不了的吗？…<br>具体的安装教程看</p><ul><li><a href="https://toolbelt.heroku.com" target="_blank" rel="noopener">https://toolbelt.heroku.com</a></li><li><a href="https://devcenter.heroku.com/articles/heroku-command#installing-the-heroku-cli" target="_blank" rel="noopener">https://devcenter.heroku.com/articles/heroku-command#installing-the-heroku-cli</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O- https://toolbelt.heroku.com/install-ubuntu.sh | sh</span><br></pre></td></tr></table></figure><h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">travis login</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku login</span><br></pre></td></tr></table></figure><h3 id="travis-yml"><a href="#travis-yml" class="headerlink" title=".travis.yml"></a>.travis.yml</h3><p>在项目的根目录下执行以下命令，将会生成<code>.travis.yml</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">travis init</span><br><span class="line">travis setup heroku</span><br></pre></td></tr></table></figure></p><blockquote><p>注意：一定要通过命令行登陆heroku，否则travis会卡住，也不报错啥的反正就一直没反应</p></blockquote><p>打开<code>.travis.yml</code>文件可以看到除了基本的信息之外，还有<code>deploy</code>相关的信息，其中比较让人疑惑的是<code>api_key</code>，这个<code>api_key</code>其实是你的heroku账户的token加密之后的一个字符串。heroku的token看起来是一个类似uuid5的字符串，可以通过以下命令查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroku auth:token</span><br></pre></td></tr></table></figure></p><p>有一个问题我不太明白的是，之前用travis加密文件<code>travis encrypt-file path/of/file --add</code>的时候，可以在travis网站对应repo的setting里看到多出的环境变量，用来加密的key value，然后需要用<code>openssl</code>命令来解密。</p><p>但加密heroku的token后，并没有生成任何新的环境变量，而且也无需在<code>.travis.yml</code>中执行解密的相关操作。</p><p>那么用来加密的key value到底存在哪里了呢？！</p><h3 id="为什么要在travis做部署，而不直接利用heroku提供的github自动部署？"><a href="#为什么要在travis做部署，而不直接利用heroku提供的github自动部署？" class="headerlink" title="为什么要在travis做部署，而不直接利用heroku提供的github自动部署？"></a>为什么要在travis做部署，而不直接利用heroku提供的github自动部署？</h3><p>首先，heroku似乎不能跑测试…</p><p>其实，大多数简单的项目其实都可以用github的方式，如果需要编译和生成的，都在<code>package.json</code>里添加<code>prepublish</code>脚本即可</p><p>我这次又是搞了一个奇怪的事情，做了一个前后端分离项目，后端提供RESTful API,前端是SPA，但是又想把SPA和API放在同一个服务器，而且分了两个repo来放前端和后端。</p><p>所以我的需求是，当前端或后端push之后，trigger travis去把前后端都克隆下来，并且编译和Build前端代码，放到指定文件夹，然后部署。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;好久么有写东西了，总感觉一直忙的跟狗一样，身心俱疲，但是又不知道到底在忙什么。&lt;/p&gt;
&lt;p&gt;最近实践了一下利用travis部署到heroku的流程，又莫名其妙的尝试了新的编辑器atom，安装了markdown-preview-plus插件，当然要来写点东西试一试， 也不知
      
    
    </summary>
    
      <category term="DEVOPS" scheme="http://sabrinaluo.com/tech/categories/DEVOPS/"/>
    
    
      <category term="travis" scheme="http://sabrinaluo.com/tech/tags/travis/"/>
    
      <category term="自动部署" scheme="http://sabrinaluo.com/tech/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/"/>
    
      <category term="持续集成" scheme="http://sabrinaluo.com/tech/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
      <category term="heroku" scheme="http://sabrinaluo.com/tech/tags/heroku/"/>
    
  </entry>
  
  <entry>
    <title>微信撤回信息昵称显示原理分析</title>
    <link href="http://sabrinaluo.com/tech/2016/04/21/theory-analysis-for-wechat-recall-message-nickname/"/>
    <id>http://sabrinaluo.com/tech/2016/04/21/theory-analysis-for-wechat-recall-message-nickname/</id>
    <published>2016-04-21T09:07:08.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<h3 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h3><p>为了让各位亲朋好友方便的用撤回信息装x，本宝宝写了一个<a href="http://sabrinaluo.com/nickname-gen">昵称生成器</a><br>虽然是比较简单的页面，但本宝宝还没发布呢，微信就封了这个功能，宝宝心里委屈但宝宝不说…</p><h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>今天早些时候，在微信群里看到了这样的撤回信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;牛奶&quot;撤回了一条信息并亲了你一下</span><br></pre></td></tr></table></figure></p><p>开始的时候我是一脸懵逼的，然后知道复制牛奶的昵称，然后再修改就可以实现这个效果，<strong>一定要复制，一个字一个字打就不行</strong>。<br>之后有同学转发了<a href="https://mp.weixin.qq.com/s?__biz=MzAwNDY5NzI4MQ==&amp;mid=505551279&amp;idx=1&amp;sn=f10a4b837a10ed9c4a252c606f2f7c7f&amp;scene=1&amp;srcid=0421JP3AeSA1CmbSqEn1rLMh&amp;from=singlemessage&amp;isappinstalled=0&amp;pass_ticket=HbJ8e6BomIu6b3R%2Bi6i69%2FT2TY3g%2FHUMQSItE5M2cd8%3D" target="_blank" rel="noopener">一篇文章</a>，然后大家纷纷搞出了各种有趣的效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. &quot;zz并亲了你一下&quot;撤回了一条消息</span><br><span class="line">2. &quot;朱饼饼息消条一了回撤&quot;并又瘦了一斤</span><br><span class="line">3. &quot;仝哈哈&quot;撤回了一条消息下一你了亲并</span><br></pre></td></tr></table></figure></p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>机智的我一开始就猜到，肯定是有些什么看不见的特殊字符导致的。</p><p>作为一只前端狗，首先想到的当然是打开web微信，F12，看看昵称里到底是什么鬼，果然不出所料，我的昵称是这样的：<code>&amp;#8238;&amp;#8238;&amp;#8238; 用卵么什有没并而然&amp;#8237;萝卜</code></p><p>于是开始找这个<code>&amp;#8238;</code>特殊字符到底是做什么的，机智的我很快就找到了<a href="http://www.fileformat.info/info/unicode/char/202e/index.htm" target="_blank" rel="noopener">^1</a><br>首先这种字符叫做<em>Unicode_control_characters</em><a href="https://en.wikipedia.org/wiki/Unicode_control_characters" target="_blank" rel="noopener">^2</a><br>要知道更详细的内容（比如这种字符最开始是用于阿拉伯文等东亚文字的排版，另外类似的字符还有好几个，但）可以看看wiki的双向文稿<a href="https://zh.wikipedia.org/wiki/%E9%9B%99%E5%90%91%E6%96%87%E7%A8%BF" target="_blank" rel="noopener">^3</a>，还有其他更详细的使用范例<a href="https://www.w3.org/International/questions/qa-bidi-unicode-controls" target="_blank" rel="noopener">^4</a></p><table><thead><tr><th style="text-align:center">html特殊符号</th><th style="text-align:center">js unicode</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>&amp;#8237;</code></td><td style="text-align:center"><code>\u202D</code></td><td style="text-align:left">Unicode Character ‘LEFT-TO-RIGHT OVERRIDE’</td></tr><tr><td style="text-align:center"><code>&amp;#8238;</code></td><td style="text-align:center"><code>\u202E</code></td><td style="text-align:left">Unicode Character ‘RIGHT-TO-LEFT OVERRIDE’</td></tr></tbody></table><p>所以<code>8237</code>的作用是从左到右显示，<code>8238</code>的作用是从右到左显示。</p><p>也就是说，跟在<code>8238</code>后面的字符串将从右到左显示（原来的排版方式会被override，直到遇到其他的控制排版的字符(Unicode_control_characters)）；而跟在<code>8237</code>后面的字符串将从左到右显示。</p><p>由于大家在复制的时候根本看不到这些字符，而且可能因为在修改昵称时<strong>删除</strong>或<strong>加多</strong>了这些特殊符号，所以产生了各种奇怪的效果。而前面提到的最正确我的昵称应该是只有一个<code>8238</code>，也就是这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#8238;用卵么什有没并而然&amp;#8237;萝卜</span><br></pre></td></tr></table></figure></p><p>微信撤回信息的显示逻辑是，<code>&quot;昵称&quot;+撤回了一条信息</code>，昵称前后是有引号的。<br>所以实际上，撤回信息的<strong>字符串</strong>是<code>&quot;&amp;#8238;用卵么什有没并而然&amp;#8237;萝卜&quot;撤回了一条信息</code>。<br>根据之前提到的<code>8238</code>和<code>8237</code>的作用以及前提条件（正常情况下我们看到的字都是从左到右显示），分解过程如下：（LTR从左到右，RTL从右到左）</p><ol><li>`第一个引号是正常显示，这个引号是LTR显示的强字符： （”）</li><li><code>&amp;#8238;</code>后面的 <em>用卵么什有没并而然</em> 是RTL显示的强字符：（”然而并没有什么卵用）</li><li><code>&amp;#8237;</code>后面的 <em>萝卜”撤回了一条信息</em> 是LTR显示的强字符，所以会<strong>紧跟</strong>前面的LTR的强字符，也就是紧跟第一个引号 ：（”萝卜”撤回了一条信息然而并没有什么卵用）</li></ol><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>上面提到的有趣的效果分析：</p><ol><li>根本没有复制到特殊符号</li><li>复制到特殊符号，但”并亲了你一下”被写反了，实际的文本为<code>&amp;#8238;并亲了你一下&amp;#8237;仝哈哈</code></li><li>复制到的特殊符号不正确，实际的文本为<code>&amp;#8238;斤一了瘦又并&amp;#8237;朱饼饼&amp;#8238;</code></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;吐槽&quot;&gt;&lt;a href=&quot;#吐槽&quot; class=&quot;headerlink&quot; title=&quot;吐槽&quot;&gt;&lt;/a&gt;吐槽&lt;/h3&gt;&lt;p&gt;为了让各位亲朋好友方便的用撤回信息装x，本宝宝写了一个&lt;a href=&quot;http://sabrinaluo.com/nickname-gen
      
    
    </summary>
    
    
      <category term="微信，撤回信息，原理分析，双向文稿，" scheme="http://sabrinaluo.com/tech/tags/%E5%BE%AE%E4%BF%A1%EF%BC%8C%E6%92%A4%E5%9B%9E%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%8C%E5%8F%8C%E5%90%91%E6%96%87%E7%A8%BF%EF%BC%8C/"/>
    
  </entry>
  
  <entry>
    <title>如何通过Git钩子自动部署(Push to Deploy)</title>
    <link href="http://sabrinaluo.com/tech/2016/04/14/push-to-deploy-through-git-hook/"/>
    <id>http://sabrinaluo.com/tech/2016/04/14/push-to-deploy-through-git-hook/</id>
    <published>2016-04-14T10:59:37.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>看了好多讲通过git钩子自动部署的，大多讲的绕来绕去乱七八糟思路一点也不清晰…<br>做了一晚上实验之后大概明白了是怎么工作的。</p><h3 id="裸仓库（bare）"><a href="#裸仓库（bare）" class="headerlink" title="裸仓库（bare）"></a>裸仓库（bare）</h3><p>裸仓库跟我们平时<code>git clone</code>得到的仓库不太一样，裸仓库其实相当于通过克隆来的仓库里的<code>.git</code>文件夹，整个裸仓库中只有git索引（index），<strong>并没有任何代码相关的东西</strong>。要实现Push to Deploy，首先我们需要一个裸仓库。</p><p>在克隆时使用 <code>--bare</code>参数来克隆一个裸仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx-bare</span><br></pre></td></tr></table></figure></p><h3 id="钩子（hook）"><a href="#钩子（hook）" class="headerlink" title="钩子（hook）"></a>钩子（hook）</h3><p>普通仓库<code>.git</code>文件夹下有一个<code>hooks</code>文件夹，裸仓库下直接有一个<code>hooks</code>文件夹，里面有各种各样以<code>.sample</code>结尾的钩子，当把<code>.sample</code>后缀删除时，钩子就是激活状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.git</span><br><span class="line">├───hooks</span><br><span class="line">│   └───post-update.sample   </span><br><span class="line">└─── ...</span><br></pre></td></tr></table></figure></p><p>你可以在钩子文件里写一些bash命令，被激活的钩子被触发时会执行你的bash命令。</p><p>与deploy相关的通常使用<code>post-update</code>钩子或者<code>post-receive</code>钩子<a href="https://www.kernel.org/pub/software/scm/git/docs/githooks.html" target="_blank" rel="noopener">^1</a>，关于这两个钩子到底有什么不同，我是没太看懂，大概的理解是这两个钩子被trigger的时候收到的信息不一样，如果需要用commit的相关信息来做一些事情的话要仔细研究（比如可以设置某个分支收到了推送就做相应的事情之类），其他如果只是通过bash来跑一些node相关的部署命令，两个都可以。这篇文章只给一个最简单的例子，跟分支啊什么的都没关系，只要收到推送就部署。</p><p>要实现Push to Deploy，我们需要修改裸仓库中相应的钩子文件</p><h3 id="裸仓库是怎么工作的"><a href="#裸仓库是怎么工作的" class="headerlink" title="裸仓库是怎么工作的"></a>裸仓库是怎么工作的</h3><p>可以在本地同一个文件夹下先创建一个裸仓库名为xxx-remote（模拟远程服务器），再创建一个xxx-local仓库（模拟本地），将xxx-remote添加为本地仓库的远程仓库，在本地仓库写一个<code>README.md</code>文件，提交并push<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx-remote</span><br><span class="line">git init xxx-local</span><br><span class="line">cd xxx-local</span><br><span class="line">git remote add origin ../xxx-remote</span><br><span class="line">echo test123&gt;README.md</span><br><span class="line">git add .</span><br><span class="line">git commit -m &apos;add readme file&apos;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure></p><p>之后切换到远程仓库文件夹，查看git log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">cd xxx-remote</span><br><span class="line">git log</span><br></pre></td></tr></table></figure></p><p>将能够看到有一条commit记录，提交信息是 add readme file，远程仓库收到了本地仓库的push</p><h3 id="钩子是怎么工作的"><a href="#钩子是怎么工作的" class="headerlink" title="钩子是怎么工作的"></a>钩子是怎么工作的</h3><p>进入远程仓库，将<code>hooks</code>文件夹下的<code>post-update.sample</code>改名为<code>post-update</code>，打开并编辑为如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">set -x #显示每条命令</span><br><span class="line">echo &quot;push push&quot;</span><br></pre></td></tr></table></figure></p><p>修改本地仓库的文件，进行一次推送，将会看到远程服务器执行了相应的命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: + echo push push</span><br><span class="line">remote: push push</span><br><span class="line">To ../xxx</span><br><span class="line"> + 41b78ee...055cec9 master -&gt; master (forced update)</span><br></pre></td></tr></table></figure></p><h3 id="一个完整的场景举例"><a href="#一个完整的场景举例" class="headerlink" title="一个完整的场景举例"></a>一个完整的场景举例</h3><p>假设有一台远程服务器上跑着一个网站，希望每次git push之后这个网站就自动更新。<br>为了方便：</p><ul><li>假设远程服务器上放了<strong>裸仓库</strong>和<strong>网站</strong>，自动部署的过程就是裸仓库收到push之后更新一下网站的文件夹</li><li>假设网站都是静态文件，不需要重启web server</li><li>假设都只考虑默认的master分支</li></ul><p>我们需要：</p><ol><li><p>在这台远程服务器上创建一个裸仓库，假如名叫xxx。克隆repo取名为website，用于存放网站文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init --bare xxx</span><br><span class="line">git clone ./xxx website</span><br></pre></td></tr></table></figure></li><li><p>修改远程服务器下<code>hooks</code>文件夹下的<code>post-update.sample</code>改名为<code>post-update</code>，编辑为如下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">set -x #显示每条命令</span><br><span class="line">git reset --hard origin/master #防止因为forced push而导致无法checkout</span><br><span class="line">git checkout</span><br></pre></td></tr></table></figure></li><li><p>在本地repo添加远程仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin ubuntu@59.64.123.123:home/xxx.git</span><br></pre></td></tr></table></figure></li></ol><p>4.在本地仓库修改文件并push</p><p>至此整个git自动部署的过程就完成了</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;看了好多讲通过git钩子自动部署的，大多讲的绕来绕去乱七八糟思路一点也不清晰…&lt;br&gt;做了一晚上实验之后大概明白了是怎么工作的。&lt;/p&gt;
&lt;h3 id=&quot;裸仓库（bare）&quot;&gt;&lt;a href=&quot;#裸仓库（bare）&quot; class=&quot;headerlink&quot; title=&quot;裸仓
      
    
    </summary>
    
      <category term="GIT" scheme="http://sabrinaluo.com/tech/categories/GIT/"/>
    
    
      <category term="git" scheme="http://sabrinaluo.com/tech/tags/git/"/>
    
      <category term="自动部署" scheme="http://sabrinaluo.com/tech/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/"/>
    
      <category term="hook" scheme="http://sabrinaluo.com/tech/tags/hook/"/>
    
  </entry>
  
  <entry>
    <title>结合使用Babel Mocha Istanbul进行ES6代码测试和覆盖率测试</title>
    <link href="http://sabrinaluo.com/tech/2016/04/12/babel-mocha-istanbul-es6-testing-and-coverage/"/>
    <id>http://sabrinaluo.com/tech/2016/04/12/babel-mocha-istanbul-es6-testing-and-coverage/</id>
    <published>2016-04-12T04:32:01.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>题外话：<br>一直以为mocha读作“抹茶”并且一直这么读了很久，直到最近看了一个mocha的教学视频，才知道这是摩卡咖啡的摩卡…而抹茶的抹茶应该是matcha…</p><p>在还没有babel的时候，一切都很简单，基础的问题就先不讨论了，这里主要记录一下Babel转码和Istanbul测覆盖率的一些坑。</p><h3 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h3><p>通常我们会有好几个文件夹，例如</p><ul><li><code>src</code>用来存放源文件，也就是包含es6,7的代码；</li><li><code>lib</code>用来存放编译后的代码</li><li><code>test</code>用来放测试脚本</li></ul><p>在<code>test</code>文件夹下，通常有一个<code>mocha.opts</code>文件用来存放mocha的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--compilers js:babel-register</span><br><span class="line">--require babel-polyfill</span><br></pre></td></tr></table></figure></p><p>如果用到了需要用babel-polyfill才能实现的方法就需要加上第二句，别忘了<code>npm install babel-polyfill --save-dev</code></p><p>生成覆盖率的测试命令：（<code>_mocha</code> 是有下划线的）<a href="http://www.ruanyifeng.com/blog/2015/06/istanbul.html" target="_blank" rel="noopener">^1</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">istanbul cover _mocha --  --opts ./test/mocha.opts</span><br></pre></td></tr></table></figure></p><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel src/ -d lib/ --presets es2015 --source-map both</span><br></pre></td></tr></table></figure><p>使用<code>--source-map both</code>参数将会生成source map，有了source map，istanbul就能够追踪到<code>src</code>下的源代码的覆盖率</p><h3 id="正确的require"><a href="#正确的require" class="headerlink" title="正确的require"></a>正确的require</h3><p>在mocha中，一定要require <code>src</code>文件夹下的文件，而不是<code>lib</code>文件夹下的文件。虽然两个文件夹下的文件mocha都能测，但是覆盖率会有一些问题。</p><h3 id="可能的问题"><a href="#可能的问题" class="headerlink" title="可能的问题"></a>可能的问题</h3><ul><li><p>出现以下错误提示时，很可能因为istanbul的版本过低，使用<code>1.0.0-alpha.2</code>版本可以正常运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No coverage information was collected, exit without writing coverage information</span><br></pre></td></tr></table></figure></li><li><p>istanbul生成的覆盖率文件里代码几乎都是<strong>红色</strong>的，这是因为编译时没有 <code>--source-map both</code> 参数，追踪的是<code>lib</code>文件夹下的覆盖率</p></li><li>istanbul生成的覆盖率文件总是显示100%，就算有些地方没测，也显示100%，这是因为在Mocha里require的是<code>lib</code>而非<code>src</code></li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>我最喜欢mocha的报告形式是<code>-R nyan</code>，一只可爱的喵星人，没有错的时候是这样的^_^，有错的时候是这样的O_O，反正就是萌萌萌。</p><p>然而最实用的报告形式可能是<code>-R mochawesome</code>，需要<code>npm i mochawesome</code>安装插件，生成直观的html测试报告<a href="http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html" target="_blank" rel="noopener">^2</a></p><p>平时遇到的问题十有八九一搜都能找到阮一峰老师的教程…这覆盖率也太高了？！</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>[1] <a href="http://www.ruanyifeng.com/blog/2015/06/istanbul.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/06/istanbul.html</a><br>[2] <a href="http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;题外话：&lt;br&gt;一直以为mocha读作“抹茶”并且一直这么读了很久，直到最近看了一个mocha的教学视频，才知道这是摩卡咖啡的摩卡…而抹茶的抹茶应该是matcha…&lt;/p&gt;
&lt;p&gt;在还没有babel的时候，一切都很简单，基础的问题就先不讨论了，这里主要记录一下Babel转码
      
    
    </summary>
    
      <category term="TOOLS" scheme="http://sabrinaluo.com/tech/categories/TOOLS/"/>
    
    
      <category term="ES6" scheme="http://sabrinaluo.com/tech/tags/ES6/"/>
    
      <category term="mocha" scheme="http://sabrinaluo.com/tech/tags/mocha/"/>
    
      <category term="istanbul" scheme="http://sabrinaluo.com/tech/tags/istanbul/"/>
    
      <category term="babel" scheme="http://sabrinaluo.com/tech/tags/babel/"/>
    
      <category term="测试" scheme="http://sabrinaluo.com/tech/tags/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="代码覆盖率" scheme="http://sabrinaluo.com/tech/tags/%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87/"/>
    
  </entry>
  
  <entry>
    <title>箭头函数的作用域和this</title>
    <link href="http://sabrinaluo.com/tech/2016/04/01/scope-and-this-of-arrow-function/"/>
    <id>http://sabrinaluo.com/tech/2016/04/01/scope-and-this-of-arrow-function/</id>
    <published>2016-04-01T08:38:12.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>JS里的作用域和this一直是一件令人头疼的事情，以前接触的不太多，毕竟面向过程编程的我基本上都不会使用“类”这个概念。</p><p>自从开始学习ES6，很长一段时间都认为箭头函数(Arrow Function)<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">^1</a>就是给懒人用的<strong>简写的匿名函数</strong>而已。后来看到有人挑战阮一峰老师<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">《ECMAScript 6入门》</a>中关于箭头函数this的一些问题<a href="https://github.com/ruanyf/es6tutorial/issues/150" target="_blank" rel="noopener">^2</a>，才对箭头函数有了一丁点的理解。</p><p>我平时的工作基本上都是各种第三方的API整合，于是各种异步请求，promise都是家常便饭。由于SalesForce没有直接的nodejs sdk，所以自己写一个自定义的类就不可避免了。在写的过程中，关于this踩到坑里了，所以就有了这篇文章。</p><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>其中一个简单的功能是，查找用户是否存在，若存在则发送欢迎邮件（整个流程对应<code>onBoardFlow</code>）。实际场景比这个要复杂，可能需要连续发送好几个请求，为了避免<em>回调地狱</em>，所有的请求我都用promise包了起来。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line">class SalesForce &#123;</span><br><span class="line">  constructor(email, username) &#123;</span><br><span class="line">    this.email = email;</span><br><span class="line">    this.username = username;</span><br><span class="line">  &#125;</span><br><span class="line">  checkUser()&#123;</span><br><span class="line">    return getUserByName(this.username); //发送一个请求到salesforce，返回一个promise</span><br><span class="line">  &#125;</span><br><span class="line">  sendEmail()&#123;</span><br><span class="line">    return send(this.email); //发送一个请求通知salesforce发送邮件，返回一个promise</span><br><span class="line">  &#125;</span><br><span class="line">  onBoardFlow()&#123;</span><br><span class="line">    //....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><p><strong>在<code>onBoardFlow</code>中，搞不清this和作用域的我首先这么写：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//例1</span><br><span class="line">this.checkuser().then(this.sendEmail);  //Cannot read property &apos;email&apos; of undefined</span><br></pre></td></tr></table></figure></p><p>然后想到了在promise链中，this指向的是global；</p><blockquote><p>Q: <strong>为什么能找到<code>this.sendEmail()</code>方法，却找不到<code>this.email</code>属性呢？</strong><br>A: 我的理解是：因为<code>this.sendEmail</code>是作为参数传入，传入的this是then外部的this，也就是<code>SalesForce</code>对象；<br>而this.sendEmail函数的作用域中产生了<strong>新的this</strong>，而这个this指向global（浏览器中为window对象）；在严格模式下this为undefined；</p></blockquote><p><strong>然后容易想到的就是各种_this self，然后bind(this) call(_this)之类的</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//例2</span><br><span class="line">this.checkuser().then(this.sendEmail.bind(this));  //it works !</span><br></pre></td></tr></table></figure></p><p>这样是可以正常工作的，但感觉怪怪的，每个then都要<code>bind(this)</code>真是一点也不优雅。</p><p><strong>匿名函数和箭头函数原来不一样啊</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//例3</span><br><span class="line">this.checkuser().then(function()&#123;</span><br><span class="line">  return this.sendEmail();</span><br><span class="line">&#125;);  //Cannot read property &apos;updateFunnelData&apos; of undefined</span><br></pre></td></tr></table></figure></p><p>此时<code>this.sendEmail</code>的this是then中的匿名函数新产生的promise作用域下的this，非严格模式下指向global</p><blockquote><p>在箭头函数出现之前，每个新定义的函数都将新产生自己作用域下的this, arguments等对象<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">^1</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例4</span><br><span class="line">this.checkuser().then(()=&gt;this.sendEmail());  //it works!</span><br></pre></td></tr></table></figure><h3 id="词法作用域"><a href="#词法作用域" class="headerlink" title="词法作用域"></a>词法作用域</h3><p>作用域内可以嵌套作用域，从而形成作用域链，在最外层的也就是全局作用域，当在内部查找一个对象时，会顺着作用域链最内层，层层向外寻找，直到找到为止。</p><p>在例3中，匿名函数的作用域中产生了新的<code>this</code>，该<code>this</code>指向global<br>在例4中，箭头函数的作用域中没有产生新的this，所以顺着作用域链层层往外寻找<code>this</code>，找到<code>onBoardFlow()</code>的作用域时，找到了<code>this</code>，而此时<code>this</code>就是<code>SalesForce</code>对象</p><h3 id="为什么promise中的this指向global"><a href="#为什么promise中的this指向global" class="headerlink" title="为什么promise中的this指向global"></a>为什么promise中的this指向global</h3><p>这个，我还没学会…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;JS里的作用域和this一直是一件令人头疼的事情，以前接触的不太多，毕竟面向过程编程的我基本上都不会使用“类”这个概念。&lt;/p&gt;
&lt;p&gt;自从开始学习ES6，很长一段时间都认为箭头函数(Arrow Function)&lt;a href=&quot;https://developer.moz
      
    
    </summary>
    
      <category term="ES6" scheme="http://sabrinaluo.com/tech/categories/ES6/"/>
    
    
      <category term="es6" scheme="http://sabrinaluo.com/tech/tags/es6/"/>
    
      <category term="箭头函数" scheme="http://sabrinaluo.com/tech/tags/%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/"/>
    
      <category term="this" scheme="http://sabrinaluo.com/tech/tags/this/"/>
    
      <category term="作用域" scheme="http://sabrinaluo.com/tech/tags/%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    
      <category term="词法作用域" scheme="http://sabrinaluo.com/tech/tags/%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>AWS EC2 SSH访问 &amp; mongodb 安装</title>
    <link href="http://sabrinaluo.com/tech/2016/03/14/aws-ec2-ssh-access-mongodb-installation/"/>
    <id>http://sabrinaluo.com/tech/2016/03/14/aws-ec2-ssh-access-mongodb-installation/</id>
    <published>2016-03-14T10:33:31.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>环境：Ubuntu</p><h3 id="SSH连接-EC2"><a href="#SSH连接-EC2" class="headerlink" title="SSH连接 EC2"></a>SSH连接 EC2</h3><p>windows下通常用putty<br>ubuntu下先打个命令<code>ssh</code>看看能否识别命令，如果能就方便很多</p><p>要连接EC2通常都会有一个<code>.pem</code>的<strong>私钥</strong>文件，另外还会有一个<strong>Public IP</strong><br>首先设置权限（并不知道这个有什么用，chmod 400使得文件只能被该文件的拥有者读取）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 /*path*/my-key-pair.pem</span><br><span class="line">ssh -i /*path*/my-key-pair.pem username@59.64.123.1</span><br></pre></td></tr></table></figure></p><p>其中username默认如下：<a href="http://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html" target="_blank" rel="noopener">^1</a></p><table><thead><tr><th style="text-align:right">OS</th><th style="text-align:right">username</th></tr></thead><tbody><tr><td style="text-align:right">Linux</td><td style="text-align:right">ec2-user</td></tr><tr><td style="text-align:right">RHEL5</td><td style="text-align:right">root 或 ec2-user</td></tr><tr><td style="text-align:right">Ubuntu</td><td style="text-align:right">ubuntu</td></tr></tbody></table><h3 id="mongodb安装及配置"><a href="#mongodb安装及配置" class="headerlink" title="mongodb安装及配置"></a>mongodb安装及配置</h3><p>有了apt-get一切真是轻松如放屁…连解压缩都不用！也不用再设置环境变量什么的（根部记不住解压缩的命令…）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mongodb</span><br></pre></td></tr></table></figure></p><p>安装好了之后，去<strong>根目录</strong>下创建<code>data</code>文件夹即可，然后打<code>mongod</code>命令，应该就启动了，此时访问<code>localhost:27017</code>，如果看到以下文字，就成功启动了芒果DB</p><blockquote><p>You are trying to access MongoDB on the native driver port. For http diagnostic access, add 1000 to the port number</p></blockquote><p>如果有error通常是没有data文件夹，设置<code>dbpath</code>后再尝试启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=./path_of _data</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;环境：Ubuntu&lt;/p&gt;
&lt;h3 id=&quot;SSH连接-EC2&quot;&gt;&lt;a href=&quot;#SSH连接-EC2&quot; class=&quot;headerlink&quot; title=&quot;SSH连接 EC2&quot;&gt;&lt;/a&gt;SSH连接 EC2&lt;/h3&gt;&lt;p&gt;windows下通常用putty&lt;br&gt;ubunt
      
    
    </summary>
    
      <category term="AWS" scheme="http://sabrinaluo.com/tech/categories/AWS/"/>
    
    
      <category term="AWS" scheme="http://sabrinaluo.com/tech/tags/AWS/"/>
    
      <category term="EC2" scheme="http://sabrinaluo.com/tech/tags/EC2/"/>
    
      <category term="ssh" scheme="http://sabrinaluo.com/tech/tags/ssh/"/>
    
      <category term="mongodb" scheme="http://sabrinaluo.com/tech/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>AWS API Gateway Mapping Template 获取IP, header等</title>
    <link href="http://sabrinaluo.com/tech/2016/03/07/aws-api-gateway-mapping-templates/"/>
    <id>http://sabrinaluo.com/tech/2016/03/07/aws-api-gateway-mapping-templates/</id>
    <published>2016-03-07T06:33:03.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>API Gateway暂时没有详细的中文文档，翻译无能的我实在不知道Mapping Template应该翻译成什么比较好。</p><h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><p>在配合API Gateway和Lambda来搭建RESTful API时，Lambda获取的payload并非通常服务器端获取的一个request对象，lambda获取到的payload并<strong>不包含 request header</strong>的内容，而只有<strong>request body</strong>的内容。</p><p>header中的部分内容可以通过API Gateway提供的变量从mapping template中获取。可以获取的内容包括IP, http方法，路由参数，query等，具体可以看文档<a href="http://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html" target="_blank" rel="noopener">^1</a></p><h3 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h3><p>按照理论来说，AWS设置可以通过界面设置的都可以通过脚本来设置。下面只介绍在界面中的设置：</p><ol><li>在API Gateway界面中选中具体的api方法，点击右侧的<strong>Intergration Request</strong></li><li>在底部点击<strong>Mapping Templates</strong></li><li>点击<strong>Add Mapping Template</strong>，输入<code>application/json</code>，点击√进行确认</li><li>在右侧新出现的区域，点击编辑按钮（铅笔图标），输入需要的变量即可，例如要获取ip：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;body&quot;: $input.json(&apos;$&apos;),</span><br><span class="line">  &quot;source_ip&quot; : &quot;$context.identity.sourceIp&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>其中<code>$input.json(&#39;$&#39;)</code>是请求时客户端发来的body</p><h3 id="response-header和cookie"><a href="#response-header和cookie" class="headerlink" title="response header和cookie"></a>response header和cookie</h3><p>在配合使用lambda和API gateway的时候，header和cookie是非常令人头疼的问题…<br>lambda返回的内容，只是response body，因此设置header要在api gateway中进行，并且也是有一些限制的：</p><ol><li>在API Gateway界面中选中具体的api方法，点击右侧的<strong>Method Response</strong></li><li>展开HTTP Status，点击<strong>Add Header</strong>，添加一个header。<blockquote><p><strong>注意</strong>：可以添加多个Header，但这些header不能同名，这也就意味着，只能有一个<code>Set-Cookie</code>，只能添加一个cookie </p></blockquote></li><li>完成以上步骤后，返回第一步所在的页面，点击<strong>Integration Response</strong>，点击三角展开，会看到<strong>Header Mappings</strong></li><li>在对应的位置编辑<strong>mapping value</strong><ul><li>如果想使用lambda返回的数据，设置为<code>integration.response.body.KEY</code></li><li>如果不是使用lambda（即把gateway用作代理），而是使用实际服务器返回的header，设置为<code>integration.response.header.KEY</code></li></ul></li></ol><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul><li><a href="http://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/how-to-method-settings-execution-console.html" target="_blank" rel="noopener">http://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/how-to-method-settings-execution-console.html</a></li><li><a href="http://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/request-response-data-mappings.html" target="_blank" rel="noopener">http://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/request-response-data-mappings.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;API Gateway暂时没有详细的中文文档，翻译无能的我实在不知道Mapping Template应该翻译成什么比较好。&lt;/p&gt;
&lt;h3 id=&quot;适用场景&quot;&gt;&lt;a href=&quot;#适用场景&quot; class=&quot;headerlink&quot; title=&quot;适用场景&quot;&gt;&lt;/a&gt;适用场景&lt;
      
    
    </summary>
    
      <category term="AWS" scheme="http://sabrinaluo.com/tech/categories/AWS/"/>
    
    
      <category term="AWS" scheme="http://sabrinaluo.com/tech/tags/AWS/"/>
    
      <category term="API Gateway" scheme="http://sabrinaluo.com/tech/tags/API-Gateway/"/>
    
      <category term="lambda" scheme="http://sabrinaluo.com/tech/tags/lambda/"/>
    
      <category term="mapping templates" scheme="http://sabrinaluo.com/tech/tags/mapping-templates/"/>
    
      <category term="header" scheme="http://sabrinaluo.com/tech/tags/header/"/>
    
  </entry>
  
  <entry>
    <title>Cookie在前端和后端的设置</title>
    <link href="http://sabrinaluo.com/tech/2016/02/29/set-cookie-from-server-side-and-client-side/"/>
    <id>http://sabrinaluo.com/tech/2016/02/29/set-cookie-from-server-side-and-client-side/</id>
    <published>2016-02-29T06:04:57.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>http协议什么的，不知道跟通信有没有关系…作为一个通信科班出身的硬<del>汉</del>妹，对各种协议基本上只能说出名字，别的一窍不通=，= 所以当我知道cookie原来是在header里的时候，当时我就震惊了…</p><p>在服务器端，各种框架都已经包装好了方便设置cookie的方法，比如nodejs的express，php的codeignitor、laravel（我居然都被迫写过php了，真是逼良为娼…）</p><p>为什么要了解设置cookie的原理呢？了解了才能在某些时候用最原始的方法来设置cookie，比如没有框架可用的时候，以及框架提供的方法不适用于某些场景的时候。<br>我是在使用laravel设置cookie的时候踩了坑，现在的项目里因为要配合使用GTM（google tag manager），所以cookie是不加密的raw data，但通过laravel设置的cookie都是加密了的。于是只能学习PHP原生的添加cookie方法。<code>setcookie(NAME, VALUE, EXPIRES)</code></p><p>另外就是因为用AWS API Gateway时候的一些需求，想要通过gateway直接设置cookie，这个时候就不得不了解http cookie的运作方式。</p><h3 id="response-cookie-从服务器端返回新cookie"><a href="#response-cookie-从服务器端返回新cookie" class="headerlink" title="response cookie 从服务器端返回新cookie"></a>response cookie 从服务器端返回新cookie</h3><p>设置cookie是通过在响应的头部加入<code>Set-Cookie</code>来设置的，</p><blockquote><ul><li>一个请求通常包含header和body</li><li>与请求有关的cookie分为request cookie和response cookie<ul><li>request cookie是浏览器已储存的cookie</li><li>response cookie是服务器端返回的新的cookie，也就是将会储存在浏览器端的新cookie</li></ul></li></ul></blockquote><h4 id="一个完整的cookie-header"><a href="#一个完整的cookie-header" class="headerlink" title="一个完整的cookie header"></a>一个完整的cookie header</h4><p>一个完整的cookie头长这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: NAME=VALUE; expires=DATE; path=PATH; domain=DOMAIN</span><br></pre></td></tr></table></figure></p><p>NAME VALUE是一对键值<br>expires是过期日期，通常用当前时间的毫秒数加上一段时间：<code>new Date().getTime()+30*24*60*60*1000)</code>，然后<strong>需要调用<code>toUTCString()</code>方法</strong><br>如果不设置expires，在浏览器中这个cookie将被当做session对待，也就是关闭了浏览器cookie就消失<br>path和domain这个…感觉不太用得到，具体可以看<a href="http://blog.sina.com.cn/s/blog_70c4d9410100z3il.html" target="_blank" rel="noopener">这篇文章</a></p><p>如果要同时设置多个cookie，同时返回多个<code>Set-Cookie</code>头即可</p><h4 id="maxAge"><a href="#maxAge" class="headerlink" title="maxAge"></a>maxAge</h4><p>有一些服务器端的框架会提供maxAge属性来设置cookie的过期时间，但是原始的Set-Cookie头是不支持maxAge的，所以在通过头部来设置cookie还是乖乖用回expires吧</p><h3 id="浏览器端读取cookie"><a href="#浏览器端读取cookie" class="headerlink" title="浏览器端读取cookie"></a>浏览器端读取cookie</h3><p>JS原生方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var cookies = document.cookie;</span><br></pre></td></tr></table></figure></p><p>读取的cookie是一个分号分隔的包含所有cookie键值字符串，可以通过正则表达式来提取需要的cookie<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var cookieA = document.cookie.replace(/(?:(?:^|.*;\s*)cookieA\s*\=\s*([^;]*).*$)|^.*$/, &quot;$1&quot;);</span><br></pre></td></tr></table></figure></p><h3 id="request-cookie-浏览器端设置cookie"><a href="#request-cookie-浏览器端设置cookie" class="headerlink" title="request cookie 浏览器端设置cookie"></a>request cookie 浏览器端设置cookie</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &apos;cookie_example=123&apos;+&apos;;expires=&apos;+expire+&apos;;path=/&apos;;</span><br></pre></td></tr></table></figure><p>如果要设置多个cookie，多次调用<code>document.cookie</code>即可</p><h4 id="document-cookie"><a href="#document-cookie" class="headerlink" title="document.cookie"></a>document.cookie</h4><p>这个document的behavior有点奇怪，明明返回的是个字符串，本来以为每次设置cookie得用新的字符串连接旧的字符串，但其实直接等于新的值也并不会覆盖旧的值，不知道实现这个属性&amp;方法混用的原理是什么0,0</p><p>####NOTE<br>通常设置cookie的时候都会把path设置为<code>/</code>，这样同一个域名下，所有路径都共用一个cookie<br>如果没有设置path，某些框架可能默认会使用创建cookie时的路径作为path，这样就可能存在多个path不同的同名cookie。</p><p>####工具</p><ul><li>在浏览器端，可以使用chrome的扩展<em>EditThisCookie</em>来查看和编辑cookie</li><li>如果是从服务器端写入的cookie，可以在F12 network 选项卡中选中请求，有cookie的时候会有一个cookie选项，能看到request cookie和response cookie</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;http协议什么的，不知道跟通信有没有关系…作为一个通信科班出身的硬&lt;del&gt;汉&lt;/del&gt;妹，对各种协议基本上只能说出名字，别的一窍不通=，= 所以当我知道cookie原来是在header里的时候，当时我就震惊了…&lt;/p&gt;
&lt;p&gt;在服务器端，各种框架都已经包装好了方便设置
      
    
    </summary>
    
    
      <category term="cookie" scheme="http://sabrinaluo.com/tech/tags/cookie/"/>
    
  </entry>
  
  <entry>
    <title>jQuery中利用JSONP进行跨域GET请求</title>
    <link href="http://sabrinaluo.com/tech/2016/02/17/using-jQuery-to-handle-CORS-with-jsonp/"/>
    <id>http://sabrinaluo.com/tech/2016/02/17/using-jQuery-to-handle-CORS-with-jsonp/</id>
    <published>2016-02-17T04:31:55.000Z</published>
    <updated>2017-12-05T09:36:02.572Z</updated>
    
    <content type="html"><![CDATA[<p>每次遇到跨域的问题真是！@#￥%</p><p>我对<code>JSONP</code>的一些浅显的理解就是，有时候会看到类似<code>http://xxx.xx.com/?callback=xxx</code>这样的请求（<code>callback=</code>也可能是<code>jsonp=</code>也可能是<code>jsonpcallback=</code>，这个取决于服务器端是怎么实现jsonp的），这样的请求做的事情简单的来说就是等得到所有数据之后就执行回调函数。</p><p>由于这个回调函数已经发给了服务器，返回的结果其实是一个函数，函数的入参是获取的数据。</p><p>jQuery的ajax请求其实能很简单的在客户端进行跨域GET请求，具体如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var options = &#123;</span><br><span class="line">  url: &apos;http://xx.xx.com/xxx&apos;,</span><br><span class="line">  method: &apos;GET&apos;,</span><br><span class="line">  dataType: &apos;jsonp&apos;,</span><br><span class="line">  //jsonp: &apos;callback&apos;,</span><br><span class="line">  success: function(data)&#123;</span><br><span class="line">    //do something here;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$.ajax(options);</span><br></pre></td></tr></table></figure></p><p>其中需要注意的是，一定要声明<strong><code>dataType</code></strong>，然后把回调函数写在success后面就可以了。<br>另外一开始提到，服务器端对jsonp的实现可能不同，所以在<code>options</code>中，有时候需要声明<code>jsonp</code>对应的字符串，默认是<code>&quot;callback&quot;</code>。例如：如果服务器实现jsonp是通过<code>http://xxx.xx.com/?jsonpcallback=xxx</code>，那么就需要在<code>options</code>中声明<code>jsonp:&#39;jsonpcallback&#39;</code></p><p>原理据说和<code>&lt;script src=&quot;...&quot;&gt;</code>差不多，我现在还不是很明白=，=</p><p>参考<br><a href="http://www.runoob.com/json/json-jsonp.html" target="_blank" rel="noopener">http://www.runoob.com/json/json-jsonp.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;每次遇到跨域的问题真是！@#￥%&lt;/p&gt;
&lt;p&gt;我对&lt;code&gt;JSONP&lt;/code&gt;的一些浅显的理解就是，有时候会看到类似&lt;code&gt;http://xxx.xx.com/?callback=xxx&lt;/code&gt;这样的请求（&lt;code&gt;callback=&lt;/code&gt;也可
      
    
    </summary>
    
      <category term="JQUERY" scheme="http://sabrinaluo.com/tech/categories/JQUERY/"/>
    
    
      <category term="CORS" scheme="http://sabrinaluo.com/tech/tags/CORS/"/>
    
      <category term="跨域" scheme="http://sabrinaluo.com/tech/tags/%E8%B7%A8%E5%9F%9F/"/>
    
      <category term="jQuery" scheme="http://sabrinaluo.com/tech/tags/jQuery/"/>
    
      <category term="JSONP" scheme="http://sabrinaluo.com/tech/tags/JSONP/"/>
    
  </entry>
  
</feed>
